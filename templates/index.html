<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>🌿 Heal Ayur - AI-Powered Ancient Healing</title>

  <!-- Meta Tags -->
  <meta name="description" content="AI-Powered Ancient Healing - Scan your face or injuries for instant Ayurvedic remedies">
  <meta name="keywords" content="AI, healing, ayurveda, skin analysis, natural remedies">
  <meta name="author" content="Heal Ayur Team">
  <meta name="theme-color" content="#4caf50">

  <!-- Enhanced Fonts for Better UX -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&family=Nunito:wght@300;400;500;600;700&family=Comfortaa:wght@300;400;500;600;700&family=Orbitron:wght@400;500;700;900&display=swap" rel="stylesheet">

  <!-- Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">

  <style>
    /* CSS Variables for Themes */
    :root {
      --primary-color: #4caf50;
      --secondary-color: #81c784;
      --accent-color: #c8e6c9;
      --success-color: #4caf50;
      --warning-color: #ff9800;
      --error-color: #f44336;
      --info-color: #2196f3;

      /* Dark Theme (Default) */
      --bg-primary: linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 100%);
      --bg-secondary: rgba(26, 26, 26, 0.8);
      --bg-card: rgba(26, 26, 26, 0.9);
      --text-primary: #ffffff;
      --text-secondary: #b0b0b0;
      --text-muted: #808080;
      --border-color: rgba(76, 175, 80, 0.2);
      --shadow-color: rgba(0, 0, 0, 0.5);

      /* Gradients */
      --gradient-primary: linear-gradient(135deg, #4caf50, #2e7d32);
      --gradient-secondary: linear-gradient(135deg, rgba(26, 26, 26, 0.9), rgba(46, 46, 46, 0.9));
      --gradient-accent: linear-gradient(135deg, #81c784, #4caf50);
      --gradient-card: linear-gradient(135deg, rgba(26, 26, 26, 0.95), rgba(46, 46, 46, 0.95));

      /* Animations */
      --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      --border-radius: 15px;
      --shadow-glow: 0 0 30px rgba(76, 175, 80, 0.3);
      --shadow-card: 0 10px 40px rgba(0, 0, 0, 0.3);
    }

    /* Light Theme */
    [data-theme="light"] {
      --bg-primary: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
      --bg-secondary: rgba(255, 255, 255, 0.9);
      --bg-card: rgba(255, 255, 255, 0.95);
      --text-primary: #212529;
      --text-secondary: #495057;
      --text-muted: #6c757d;
      --border-color: rgba(76, 175, 80, 0.3);
      --shadow-color: rgba(0, 0, 0, 0.1);
      --gradient-secondary: linear-gradient(135deg, rgba(255, 255, 255, 0.9), rgba(248, 249, 250, 0.9));
      --gradient-card: linear-gradient(135deg, rgba(255, 255, 255, 0.95), rgba(248, 249, 250, 0.95));
      --shadow-card: 0 10px 40px rgba(0, 0, 0, 0.1);
    }

    /* Base Styles */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Poppins', 'Nunito', sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      line-height: 1.6;
      overflow-x: hidden;
      transition: var(--transition);
      min-height: 100vh;
      font-weight: 400;
      letter-spacing: 0.3px;
    }

    /* Background Animation Canvas */
    .background-animation {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -2;
      opacity: 0.6;
    }

    /* Particles */
    .particles-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -1;
      pointer-events: none;
    }

    .particle {
      position: absolute;
      background: var(--primary-color);
      border-radius: 50%;
      opacity: 0.4;
      animation: float 8s ease-in-out infinite;
    }

    @keyframes float {
      0%, 100% {
        transform: translateY(0px) rotate(0deg) scale(1);
        opacity: 0.4;
      }
      25% {
        transform: translateY(-30px) rotate(90deg) scale(1.1);
        opacity: 0.6;
      }
      50% {
        transform: translateY(-60px) rotate(180deg) scale(0.9);
        opacity: 0.8;
      }
      75% {
        transform: translateY(-30px) rotate(270deg) scale(1.05);
        opacity: 0.5;
      }
    }

    @keyframes pulse {
      0%, 100% {
        opacity: 1;
        transform: scale(1);
        box-shadow: 0 0 0 0 rgba(76, 175, 80, 0.7);
      }
      50% {
        opacity: 0.8;
        transform: scale(1.05);
        box-shadow: 0 0 0 10px rgba(76, 175, 80, 0);
      }
    }

    /* 3D Gradient Orbs */
    .gradient-orb {
      position: fixed;
      border-radius: 50%;
      filter: blur(80px);
      opacity: 0.6;
      z-index: -1;
      animation: orbFloat 12s ease-in-out infinite;
    }

    .orb-1 {
      width: 400px;
      height: 400px;
      background: radial-gradient(circle, #4caf50, #2e7d32, #1b5e20);
      top: 10%;
      left: 10%;
      animation-delay: 0s;
    }

    .orb-2 {
      width: 300px;
      height: 300px;
      background: radial-gradient(circle, #81c784, #4caf50, #2e7d32);
      top: 60%;
      right: 10%;
      animation-delay: 4s;
    }

    .orb-3 {
      width: 350px;
      height: 350px;
      background: radial-gradient(circle, #2196f3, #1976d2, #0d47a1);
      bottom: 10%;
      left: 50%;
      animation-delay: 8s;
    }

    @keyframes orbFloat {
      0%, 100% {
        transform: translate(0, 0) scale(1) rotate(0deg);
      }
      25% {
        transform: translate(50px, -50px) scale(1.2) rotate(90deg);
      }
      50% {
        transform: translate(-30px, 30px) scale(0.8) rotate(180deg);
      }
      75% {
        transform: translate(30px, -20px) scale(1.1) rotate(270deg);
      }
    }

    /* Theme Toggle */
    .theme-toggle {
      position: fixed;
      top: 1rem;
      right: 1rem;
      z-index: 1002;
      background: var(--gradient-card);
      border: 1px solid var(--border-color);
      border-radius: 50px;
      padding: 0.5rem;
      display: flex;
      gap: 0.5rem;
      backdrop-filter: blur(20px);
      box-shadow: var(--shadow-card);
      transform: translateZ(0);
    }

    .theme-btn {
      width: 45px;
      height: 45px;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      transition: var(--transition);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.2rem;
      position: relative;
      overflow: hidden;
    }

    .theme-btn.active {
      background: var(--gradient-primary);
      color: white;
      transform: scale(1.1);
      box-shadow: var(--shadow-glow);
    }

    .theme-btn:not(.active) {
      background: transparent;
      color: var(--text-muted);
    }

    .theme-btn:hover {
      transform: scale(1.05);
    }

    .theme-btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
      transition: left 0.5s;
    }

    .theme-btn:hover::before {
      left: 100%;
    }

    /* Navigation */
    .navbar {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 1000;
      background: var(--gradient-secondary);
      backdrop-filter: blur(20px);
      border-bottom: 1px solid var(--border-color);
      padding: 1rem 2rem;
      transition: var(--transition);
    }

    .nav-container {
      display: flex;
      justify-content: space-between;
      align-items: center;
      max-width: 1200px;
      margin: 0 auto;
    }

    .nav-brand {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-weight: 700;
      font-size: 1.3rem;
      color: var(--primary-color);
    }

    .contact-info {
      position: fixed;
      top: 50%;
      left: 1rem;
      transform: translateY(-50%);
      z-index: 1001;
      background: var(--gradient-card);
      border: 1px solid var(--border-color);
      border-radius: 50px;
      padding: 1rem 0.5rem;
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
      backdrop-filter: blur(20px);
      box-shadow: var(--shadow-card);
      writing-mode: vertical-lr;
      text-orientation: mixed;
    }

    .contact-btn {
      width: 45px;
      height: 45px;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      transition: var(--transition);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.1rem;
      background: var(--gradient-primary);
      color: white;
      text-decoration: none;
      position: relative;
      overflow: hidden;
    }

    .contact-btn:hover {
      transform: scale(1.1);
      box-shadow: var(--shadow-glow);
    }

    .contact-btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
      transition: left 0.5s;
    }

    .contact-btn:hover::before {
      left: 100%;
    }

    .nav-brand i {
      font-size: 1.8rem;
      animation: pulse 3s infinite;
    }

    .nav-menu {
      display: flex;
      gap: 1rem;
      align-items: center;
    }

    .user-info {
      display: flex;
      align-items: center;
      gap: 1rem;
      padding: 0.75rem 1.5rem;
      background: var(--gradient-card);
      border-radius: 30px;
      border: 1px solid var(--border-color);
      backdrop-filter: blur(20px);
      box-shadow: var(--shadow-card);
    }

    .user-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: var(--gradient-primary);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: 700;
      font-size: 1.1rem;
      box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);
    }

    /* Buttons */
    .btn {
      padding: 0.75rem 1.5rem;
      border: none;
      border-radius: var(--border-radius);
      font-weight: 600;
      cursor: pointer;
      transition: var(--transition);
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      justify-content: center;
      font-size: 0.9rem;
      position: relative;
      overflow: hidden;
    }

    .btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
      transition: left 0.5s;
    }

    .btn:hover::before {
      left: 100%;
    }

    .btn-primary {
      background: var(--gradient-primary);
      color: white;
      box-shadow: 0 6px 20px rgba(76, 175, 80, 0.4);
    }

    .btn-secondary {
      background: var(--gradient-card);
      color: var(--text-primary);
      border: 1px solid var(--border-color);
      backdrop-filter: blur(20px);
    }

    .btn-danger {
      background: linear-gradient(135deg, #f44336, #d32f2f);
      color: white;
      box-shadow: 0 6px 20px rgba(244, 67, 54, 0.4);
    }

    .btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 12px 35px var(--shadow-color);
    }

    .btn:active {
      transform: translateY(-1px);
    }

    /* Cards */
    .card {
      background: var(--gradient-card);
      border-radius: var(--border-radius);
      border: 1px solid var(--border-color);
      backdrop-filter: blur(20px);
      box-shadow: var(--shadow-card);
      transition: var(--transition);
      overflow: hidden;
      position: relative;
    }

    .card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: var(--gradient-primary);
      transform: scaleX(0);
      transition: transform 0.3s ease;
    }

    .card:hover::before {
      transform: scaleX(1);
    }

    .card:hover {
      transform: translateY(-8px) rotateX(5deg);
      box-shadow: 0 20px 60px var(--shadow-color);
    }

    .card-header {
      padding: 1.5rem;
      border-bottom: 1px solid var(--border-color);
    }

    .card-body {
      padding: 1.5rem;
    }

    .card-footer {
      padding: 1rem 1.5rem;
      border-top: 1px solid var(--border-color);
      background: rgba(76, 175, 80, 0.05);
    }

    /* AI Assistant */
    .ai-assistant {
      position: fixed;
      bottom: 2rem;
      right: 2rem;
      width: 70px;
      height: 70px;
      background: var(--gradient-primary);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      box-shadow: 0 8px 30px rgba(76, 175, 80, 0.5);
      transition: var(--transition);
      z-index: 1001;
      animation: pulse 3s infinite;
    }

    .ai-assistant:hover {
      transform: scale(1.15) rotateY(15deg);
      box-shadow: 0 12px 40px rgba(76, 175, 80, 0.7);
    }

    .ai-assistant i {
      font-size: 2rem;
      color: white;
    }

    .ai-chat {
      position: fixed;
      bottom: 6rem;
      right: 2rem;
      width: 380px;
      height: 500px;
      background: var(--gradient-card);
      backdrop-filter: blur(20px);
      border-radius: var(--border-radius);
      border: 1px solid var(--border-color);
      display: none;
      flex-direction: column;
      z-index: 1000;
      box-shadow: var(--shadow-card);
      transform: translateY(20px);
      opacity: 0;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .ai-chat.show {
      display: flex;
      transform: translateY(0);
      opacity: 1;
    }

    .chat-header {
      padding: 1.5rem;
      border-bottom: 1px solid var(--border-color);
      display: flex;
      align-items: center;
      gap: 0.75rem;
      background: rgba(76, 175, 80, 0.1);
      border-radius: var(--border-radius) var(--border-radius) 0 0;
    }

    .chat-messages {
      flex: 1;
      padding: 1rem;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }

    .chat-message {
      padding: 1rem;
      border-radius: 15px;
      max-width: 85%;
      animation: messageSlideIn 0.4s ease-out;
      position: relative;
    }

    .chat-message.ai {
      background: rgba(76, 175, 80, 0.2);
      align-self: flex-start;
      border-bottom-left-radius: 5px;
    }

    .chat-message.user {
      background: var(--gradient-secondary);
      align-self: flex-end;
      border-bottom-right-radius: 5px;
      color: var(--text-primary);
    }

    .chat-input-container {
      padding: 1rem;
      border-top: 1px solid var(--border-color);
      background: rgba(76, 175, 80, 0.05);
    }

    .chat-input-wrapper {
      display: flex;
      gap: 0.5rem;
      align-items: center;
    }

    .chat-input {
      flex: 1;
      padding: 0.75rem;
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: 12px;
      color: var(--text-primary);
      font-size: 0.9rem;
      transition: var(--transition);
    }

    .chat-input:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.2);
    }

    .chat-send-btn {
      padding: 0.75rem;
      background: var(--gradient-primary);
      border: none;
      border-radius: 12px;
      color: white;
      cursor: pointer;
      transition: var(--transition);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .chat-send-btn:hover {
      transform: scale(1.05);
      box-shadow: 0 4px 15px rgba(76, 175, 80, 0.4);
    }

    @keyframes messageSlideIn {
      from {
        opacity: 0;
        transform: translateY(15px) scale(0.95);
      }
      to {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }

    /* Container */
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 2rem;
      margin-top: 6rem;
    }

    /* Header */
    .header {
      text-align: center;
      margin-bottom: 4rem;
    }

    .logo {
      margin-bottom: 2rem;
    }

    .logo i {
      font-size: 5rem;
      color: var(--primary-color);
      margin-bottom: 1rem;
      display: block;
      animation: pulse 2s infinite;
    }

    .logo h1 {
      font-family: 'Comfortaa', 'Poppins', serif;
      font-size: 3.5rem;
      font-weight: 700;
      margin-bottom: 0.5rem;
      background: var(--gradient-primary);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      text-shadow: 0 4px 8px rgba(76, 175, 80, 0.3);
      letter-spacing: 1px;
    }

    .subtitle {
      font-size: 1.3rem;
      color: var(--text-secondary);
      margin-bottom: 2rem;
      font-weight: 400;
    }

    /* Feature Badges */
    .feature-badges {
      display: flex;
      justify-content: center;
      gap: 1rem;
      margin: 2rem 0;
      flex-wrap: wrap;
    }

    .feature-badge {
      background: var(--gradient-card);
      border: 1px solid var(--border-color);
      border-radius: 25px;
      padding: 0.75rem 1.5rem;
      font-size: 0.9rem;
      color: var(--text-secondary);
      backdrop-filter: blur(20px);
      transition: var(--transition);
      cursor: pointer;
    }

    .feature-badge:hover {
      transform: translateY(-3px);
      box-shadow: var(--shadow-glow);
      color: var(--primary-color);
    }

    /* Stats Bar */
    .stats-bar {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 1.5rem;
      margin: 3rem 0;
    }

    .stat-item {
      text-align: center;
      padding: 2rem 1rem;
      background: var(--gradient-card);
      border-radius: var(--border-radius);
      border: 1px solid var(--border-color);
      backdrop-filter: blur(20px);
      cursor: pointer;
      transition: var(--transition);
      position: relative;
      overflow: hidden;
    }

    .stat-item::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: var(--gradient-primary);
      transform: scaleX(0);
      transition: transform 0.3s ease;
    }

    .stat-item:hover::before {
      transform: scaleX(1);
    }

    .stat-item:hover {
      transform: translateY(-8px) rotateX(5deg);
      box-shadow: var(--shadow-glow);
    }

    .stat-number {
      font-size: 2rem;
      font-weight: 700;
      color: var(--primary-color);
      margin-bottom: 0.5rem;
      font-family: 'Orbitron', monospace;
    }

    .stat-label {
      font-size: 0.9rem;
      color: var(--text-secondary);
      margin-bottom: 1rem;
      font-weight: 500;
    }

    .stat-progress {
      width: 100%;
      height: 6px;
      background: rgba(76, 175, 80, 0.2);
      border-radius: 3px;
      overflow: hidden;
      margin-top: 1rem;
    }

    .stat-progress-bar {
      height: 100%;
      background: var(--gradient-primary);
      border-radius: 3px;
      transition: width 2s ease-out;
      box-shadow: 0 0 10px rgba(76, 175, 80, 0.5);
    }

    /* Upload Section */
    .upload-section {
      margin: 4rem 0;
    }

    .upload-section h2 {
      text-align: center;
      margin-bottom: 2rem;
      font-size: 2rem;
      color: var(--text-primary);
      font-weight: 600;
    }

    .upload-methods {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 2rem;
      margin-bottom: 2rem;
    }

    .upload-method {
      background: var(--gradient-card);
      border: 2px dashed var(--border-color);
      border-radius: var(--border-radius);
      padding: 3rem 2rem;
      text-align: center;
      cursor: pointer;
      transition: var(--transition);
      position: relative;
      overflow: hidden;
    }

    .upload-method::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(76, 175, 80, 0.1), transparent);
      transition: left 0.6s;
    }

    .upload-method:hover::before {
      left: 100%;
    }

    .upload-method:hover {
      transform: translateY(-5px) scale(1.02);
      border-color: var(--primary-color);
      box-shadow: var(--shadow-glow);
    }

    .upload-method i {
      font-size: 3rem;
      color: var(--primary-color);
      margin-bottom: 1rem;
      display: block;
    }

    .upload-method h3 {
      font-size: 1.3rem;
      margin-bottom: 0.5rem;
      color: var(--text-primary);
    }

    .upload-method p {
      color: var(--text-secondary);
      font-size: 0.95rem;
    }

    /* Webcam Container */
    .webcam-container {
      display: none;
      background: var(--gradient-card);
      border-radius: var(--border-radius);
      padding: 2rem;
      margin: 2rem 0;
      border: 1px solid var(--border-color);
      text-align: center;
    }

    .webcam-container.show {
      display: block;
      animation: slideInUp 0.5s ease-out;
    }

    #videoElement {
      width: 100%;
      max-width: 500px;
      border-radius: var(--border-radius);
      box-shadow: var(--shadow-card);
      margin-bottom: 1.5rem;
    }

    .webcam-controls {
      display: flex;
      gap: 1rem;
      justify-content: center;
      flex-wrap: wrap;
    }

    /* Loading Container */
    .loading-container {
      display: none;
      text-align: center;
      padding: 3rem;
      background: var(--gradient-card);
      border-radius: var(--border-radius);
      border: 1px solid var(--border-color);
      margin: 2rem 0;
    }

    .loading-container.show {
      display: block;
      animation: fadeIn 0.5s ease-out;
    }

    .loading-spinner {
      width: 60px;
      height: 60px;
      border: 4px solid rgba(76, 175, 80, 0.3);
      border-top: 4px solid var(--primary-color);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto 1.5rem auto;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .loading-text {
      font-size: 1.1rem;
      color: var(--text-primary);
      margin-bottom: 1rem;
    }

    .loading-progress {
      width: 100%;
      max-width: 300px;
      height: 8px;
      background: rgba(76, 175, 80, 0.2);
      border-radius: 4px;
      overflow: hidden;
      margin: 0 auto;
    }

    .loading-progress-bar {
      height: 100%;
      background: var(--gradient-primary);
      border-radius: 4px;
      animation: progressFill 3s ease-out infinite;
    }

    @keyframes progressFill {
      0% { width: 0%; }
      50% { width: 70%; }
      100% { width: 100%; }
    }

    /* Results Container */
    .results-container {
      display: none;
      margin: 3rem 0;
    }

    .results-container.show {
      display: block;
      animation: slideInUp 0.6s ease-out;
    }

    .result-card {
      background: var(--gradient-card);
      border-radius: var(--border-radius);
      border: 1px solid var(--border-color);
      padding: 2rem;
      margin-bottom: 2rem;
      box-shadow: var(--shadow-card);
      transition: var(--transition);
    }

    .result-card:hover {
      transform: translateY(-5px);
      box-shadow: var(--shadow-glow);
    }

    .condition-result {
      text-align: center;
      margin-bottom: 2rem;
    }

    .condition-name {
      font-size: 2rem;
      font-weight: 700;
      color: var(--primary-color);
      margin-bottom: 0.5rem;
    }

    .confidence-score {
      font-size: 1.2rem;
      color: var(--text-secondary);
      margin-bottom: 1rem;
    }

    .remedies-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 1.5rem;
    }

    .remedy-card {
      background: var(--gradient-card);
      border-radius: var(--border-radius);
      border: 1px solid var(--border-color);
      padding: 1.5rem;
      transition: var(--transition);
    }

    .remedy-card:hover {
      transform: translateY(-3px) rotateX(2deg);
      box-shadow: var(--shadow-glow);
    }

    .remedy-title {
      font-size: 1.2rem;
      font-weight: 600;
      color: var(--primary-color);
      margin-bottom: 1rem;
    }

    .remedy-description {
      color: var(--text-secondary);
      margin-bottom: 1rem;
      line-height: 1.6;
    }

    .remedy-meta {
      display: flex;
      gap: 1rem;
      font-size: 0.85rem;
      color: var(--text-muted);
      margin-top: 1rem;
    }

    /* Animations */
    @keyframes slideInUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    /* Enhanced Footer */
    .footer {
      padding: 3rem 2rem 1rem;
      margin-top: 4rem;
      border-top: 1px solid var(--border-color);
      background: var(--gradient-secondary);
    }

    .footer-content {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 2rem;
      max-width: 1200px;
      margin: 0 auto;
      color: var(--text-secondary);
    }

    .footer-section h4 {
      font-family: 'Comfortaa', sans-serif;
      font-weight: 600;
    }

    .footer-contact p {
      margin: 0.5rem 0;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .footer-contact a {
      color: var(--text-secondary);
      text-decoration: none;
      transition: var(--transition);
    }

    .footer-contact a:hover {
      color: var(--primary-color);
    }

    .footer-bottom {
      text-align: center;
    }

    .footer-links a {
      transition: var(--transition);
    }

    .footer-links a:hover {
      color: var(--primary-color) !important;
    }

    /* Responsive Design */
    @media (max-width: 768px) {
      .container {
        padding: 1rem;
        margin-top: 6rem; /* Increased to prevent navbar overlap */
      }

      .navbar {
        padding: 0.75rem 1rem;
        position: fixed;
        z-index: 1001;
      }

      .nav-container {
        flex-direction: row; /* Keep horizontal on mobile */
        justify-content: space-between;
        align-items: center;
        gap: 0.5rem;
      }

      .user-info {
        flex-direction: row !important;
        gap: 0.5rem !important;
        padding: 0.5rem 0.75rem !important;
        font-size: 0.8rem !important;
      }

      .user-avatar {
        width: 30px !important;
        height: 30px !important;
        font-size: 0.9rem !important;
      }

      .contact-info {
        left: 0.5rem;
        top: 45%; /* Adjusted to avoid navbar */
        padding: 0.5rem 0.25rem;
        z-index: 999; /* Lower than navbar */
      }

      .contact-btn {
        width: 35px;
        height: 35px;
        font-size: 0.9rem;
      }

      .footer-content {
        grid-template-columns: 1fr;
        gap: 1.5rem;
      }

      .footer-bottom-content {
        flex-direction: column;
        text-align: center;
      }

      /* Hide premium badges on mobile for cleaner look */
      .feature-badges {
        display: none !important;
      }

      /* Hide call-to-action section on mobile to reduce clutter */
      .cta-section {
        display: none !important;
      }

      /* Optimize logo and subtitle for mobile */
      .logo h1 {
        font-size: 2.2rem !important;
        line-height: 1.2;
      }

      .subtitle {
        font-size: 1rem !important;
        line-height: 1.4;
        padding: 0 1rem;
      }

      /* Simplify upload section for mobile */
      .upload-methods {
        grid-template-columns: 1fr !important;
        gap: 1rem;
      }

      .upload-method {
        padding: 1.5rem 1rem !important;
        text-align: center;
      }

      .upload-method h3 {
        font-size: 1.1rem !important;
      }

      .upload-method p {
        font-size: 0.9rem !important;
      }

      .logo h1 {
        font-size: 2.5rem;
      }

      .subtitle {
        font-size: 1.1rem;
      }

      .stats-bar {
        grid-template-columns: repeat(2, 1fr);
        gap: 1rem;
      }

      .upload-methods {
        grid-template-columns: 1fr;
        gap: 1rem;
      }

      .upload-method {
        padding: 2rem 1rem;
      }

      .ai-chat {
        width: 90vw;
        right: 5vw;
        height: 70vh;
      }

      .theme-toggle {
        top: 0.5rem;
        right: 0.5rem;
        padding: 0.25rem;
      }

      .theme-btn {
        width: 35px;
        height: 35px;
        font-size: 1rem;
      }

      .user-info {
        flex-direction: column;
        text-align: center;
        padding: 0.5rem 1rem;
      }

      .upload-methods {
        grid-template-columns: 1fr;
        gap: 1rem;
      }

      .upload-method {
        padding: 1.5rem;
      }

      .remedies-grid {
        grid-template-columns: 1fr;
        gap: 1rem;
      }

      .stats-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 1rem;
      }

      .ai-chat {
        width: 95vw;
        right: 2.5vw;
        height: 70vh;
        bottom: 5rem;
      }

      .ai-assistant {
        width: 60px;
        height: 60px;
        bottom: 1rem;
        right: 1rem;
      }

      .ai-assistant i {
        font-size: 1.5rem;
      }

      .webcam-controls {
        flex-direction: column;
        align-items: center;
      }

      .remedies-grid {
        grid-template-columns: 1fr;
      }

      .feature-badges {
        gap: 0.5rem;
      }

      .feature-badge {
        padding: 0.5rem 1rem;
        font-size: 0.8rem;
      }

      /* Hide feature badges on mobile for cleaner look */
      .feature-badges {
        display: none !important;
      }

      /* Hide call-to-action section on mobile to reduce clutter */
      .cta-section {
        display: none !important;
      }

      /* Hide complex animations on mobile for performance */
      .gradient-orb {
        display: none !important;
      }

      .particles-container {
        display: none !important;
      }

      /* Optimize buttons for mobile */
      .btn {
        padding: 1rem 1.5rem !important;
        font-size: 1rem !important;
        width: 100%;
        margin: 0.5rem 0;
        border-radius: 12px !important;
      }

      /* Mobile-friendly upload section */
      .upload-method {
        border: 2px solid var(--border-color) !important;
        border-radius: 15px !important;
        transition: all 0.3s ease !important;
      }

      .upload-method:hover {
        border-color: var(--primary-color) !important;
        transform: translateY(-2px) !important;
      }

      /* Optimize stats for mobile */
      .stat-item {
        border-radius: 15px !important;
        background: var(--gradient-card) !important;
      }

      /* Mobile-friendly cards */
      .card {
        border-radius: 15px !important;
        margin: 1rem 0 !important;
      }

      /* Add mobile-specific welcome banner */
      .mobile-welcome {
        display: block !important;
        margin: 2rem 0;
        padding: 1.5rem;
        background: linear-gradient(135deg, rgba(76, 175, 80, 0.15), rgba(129, 199, 132, 0.1));
        border-radius: 20px;
        border: 2px solid rgba(76, 175, 80, 0.4);
        text-align: center;
        animation: pulse 3s infinite;
      }

      .mobile-welcome h3 {
        color: var(--primary-color);
        font-size: 1.2rem;
        margin-bottom: 0.5rem;
        font-family: 'Comfortaa', sans-serif;
      }

      .mobile-welcome p {
        color: var(--text-secondary);
        font-size: 0.9rem;
        margin: 0;
      }

      /* Mobile chat optimization - Fix overlaps */
      .ai-chat {
        width: 95vw !important;
        height: 70vh !important;
        bottom: 1rem !important;
        right: 2.5% !important;
        left: 2.5% !important;
        max-height: calc(100vh - 8rem) !important;
        z-index: 10001 !important;
      }

      .ai-assistant {
        bottom: 1rem !important;
        right: 1rem !important;
        width: 60px !important;
        height: 60px !important;
        z-index: 10002 !important;
      }

      /* Fix modal overlaps on mobile */
      .modal > div {
        width: 95vw !important;
        max-width: 95vw !important;
        margin: 1rem !important;
        max-height: 90vh !important;
        overflow-y: auto !important;
      }

      /* Hide desktop-specific elements on mobile */
      .desktop-only {
        display: none !important;
      }

      /* Simplify navigation on mobile */
      .nav-menu {
        flex-direction: row !important;
        gap: 0.5rem !important;
        justify-content: space-between !important;
        align-items: center !important;
      }

      /* Fix user info overlap */
      .user-info {
        padding: 0.5rem 0.75rem !important;
        font-size: 0.8rem !important;
        flex-direction: row !important;
        gap: 0.5rem !important;
      }

      /* Fix upload section spacing */
      .upload-section {
        margin: 2rem 0 !important;
        padding: 0 0.5rem !important;
      }

      .upload-methods {
        grid-template-columns: 1fr !important;
        gap: 1rem !important;
      }

      /* Fix analyze button positioning */
      #analyzeBtn {
        width: 100% !important;
        margin: 1rem 0 !important;
        padding: 1rem !important;
        font-size: 1.1rem !important;
      }

      #analyzeEncouragement {
        margin: 1rem 0 !important;
        padding: 1rem !important;
        font-size: 0.9rem !important;
      }
    }

    /* Tablet Design */
    @media (max-width: 1024px) and (min-width: 769px) {
      .container {
        padding: 1.5rem;
      }

      .upload-methods {
        grid-template-columns: repeat(2, 1fr);
      }

      .remedies-grid {
        grid-template-columns: repeat(2, 1fr);
      }

      .stats-grid {
        grid-template-columns: repeat(3, 1fr);
      }

      .footer-content {
        grid-template-columns: repeat(2, 1fr);
      }

      .ai-chat {
        width: 400px;
        height: 550px;
      }
    }

    @media (max-width: 480px) {
      /* Hide feature badges completely on small mobile */
      .feature-badges {
        display: none !important;
      }

      /* Hide call-to-action section on small mobile */
      .cta-section {
        display: none !important;
      }

      .logo i {
        font-size: 3rem;
      }

      .logo h1 {
        font-size: 2rem;
      }

      .stat-number {
        font-size: 1.5rem;
      }

      .upload-method i {
        font-size: 2rem;
      }

      /* Make upload methods more attractive on mobile */
      .upload-method {
        background: var(--gradient-card) !important;
        border: 2px solid var(--primary-color) !important;
        border-radius: 20px !important;
        box-shadow: 0 8px 25px rgba(76, 175, 80, 0.2) !important;
      }

      .upload-method:hover {
        transform: translateY(-5px) !important;
        box-shadow: 0 15px 35px rgba(76, 175, 80, 0.3) !important;
      }

      .ai-assistant {
        width: 60px;
        height: 60px;
        bottom: 1rem;
        right: 1rem;
      }

      .ai-assistant i {
        font-size: 1.5rem;
      }

      .container {
        padding: 0.5rem;
        margin-top: 4rem;
      }

      .navbar {
        padding: 0.5rem 1rem;
      }

      .nav-brand {
        font-size: 1.1rem;
      }

      .subtitle {
        font-size: 0.9rem;
      }

      /* Mobile-specific subtitle styling */
      .subtitle span {
        display: block !important;
        margin: 0.5rem 0 !important;
        padding: 0.5rem 1rem !important;
        background: rgba(76, 175, 80, 0.1) !important;
        border-radius: 15px !important;
        border: 1px solid rgba(76, 175, 80, 0.3) !important;
      }

      .upload-method {
        padding: 1rem;
      }

      .upload-method h3 {
        font-size: 1rem;
      }

      .btn {
        padding: 0.5rem 1rem;
        font-size: 0.8rem;
      }

      .card {
        margin: 0.5rem 0;
        padding: 1rem;
      }

      .webcam-controls {
        flex-direction: column;
        gap: 0.5rem;
      }

      .webcam-controls .btn {
        width: 100%;
      }

      .contact-info {
        left: 0.25rem;
        padding: 0.25rem;
      }

      .contact-btn {
        width: 30px;
        height: 30px;
        font-size: 0.8rem;
      }

      .theme-toggle {
        top: 0.25rem;
        right: 0.25rem;
        padding: 0.25rem;
      }

      .theme-btn {
        width: 30px;
        height: 30px;
        font-size: 0.9rem;
      }

      .ai-chat {
        width: 98vw;
        right: 1vw;
        height: 80vh;
        bottom: 4rem;
      }

      .footer-content {
        padding: 1rem;
      }

      .footer-section {
        text-align: center;
      }

      .footer-bottom-content {
        font-size: 0.8rem;
      }

      .notification-container {
        top: 1rem;
        right: 1rem;
      }

      .notification-toast {
        min-width: 250px;
        max-width: 300px;
        padding: 0.75rem 1rem;
        font-size: 0.85rem;
      }
    }

    /* Notification Container */
    .notification-container {
      position: fixed;
      top: 2rem;
      right: 2rem;
      z-index: 10000;
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
      pointer-events: none;
    }

    /* Notification Styles */
    .notification-toast {
      background: var(--gradient-card);
      border: 1px solid var(--border-color);
      border-radius: var(--border-radius);
      padding: 1rem 1.5rem;
      box-shadow: var(--shadow-card);
      backdrop-filter: blur(20px);
      max-width: 400px;
      min-width: 300px;
      animation: slideInRight 0.4s ease-out;
      pointer-events: auto;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .notification-toast.success {
      border-left: 4px solid var(--success-color);
    }

    .notification-toast.error {
      border-left: 4px solid var(--error-color);
    }

    .notification-toast.warning {
      border-left: 4px solid var(--warning-color);
    }

    .notification-toast.info {
      border-left: 4px solid var(--info-color);
    }

    @keyframes slideInRight {
      from {
        opacity: 0;
        transform: translateX(100%);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    @keyframes slideOutRight {
      from {
        opacity: 1;
        transform: translateX(0);
      }
      to {
        opacity: 0;
        transform: translateX(100%);
      }
    }

    @keyframes glow {
      from {
        box-shadow: 0 0 5px #ffd700, 0 0 10px #ffd700, 0 0 15px #ffd700;
      }
      to {
        box-shadow: 0 0 10px #ffd700, 0 0 20px #ffd700, 0 0 30px #ffd700;
      }
    }
  </style>
</head>
<body>
  <!-- Theme Toggle -->
  <div class="theme-toggle">
    <button class="theme-btn active" onclick="setTheme('dark')" title="Dark Theme">
      <i class="fas fa-moon"></i>
    </button>
    <button class="theme-btn" onclick="setTheme('light')" title="Light Theme">
      <i class="fas fa-sun"></i>
    </button>
  </div>

  <!-- Contact Information -->
  <div class="contact-info">
    <a href="#contact" class="contact-btn" title="Contact Us" onclick="showContactModal()">
      <i class="fas fa-envelope"></i>
    </a>
    <a href="#support" class="contact-btn" title="24/7 Support" onclick="showSupportModal()">
      <i class="fas fa-headset"></i>
    </a>
    <a href="#help" class="contact-btn" title="Help & FAQ" onclick="showHelpModal()">
      <i class="fas fa-question-circle"></i>
    </a>
    <a href="#feedback" class="contact-btn" title="Feedback" onclick="showFeedbackModal()">
      <i class="fas fa-comment"></i>
    </a>
  </div>

  <!-- Notification Container -->
  <div class="notification-container" id="notificationContainer"></div>

  <!-- Background Effects -->
  <canvas id="bgCanvas" class="background-animation"></canvas>
  <div class="particles-container" id="particlesContainer"></div>
  <div class="gradient-orb orb-1"></div>
  <div class="gradient-orb orb-2"></div>
  <div class="gradient-orb orb-3"></div>

  <!-- Navigation Bar -->
  <nav class="navbar">
    <div class="nav-container">
      <div class="nav-brand">
        <i class="fas fa-leaf"></i>
        <span>Heal Ayur</span>
      </div>

      <div class="nav-menu" id="navMenu">
        {% if user %}
          <div class="user-info">
            <div class="user-avatar" onclick="showUserProfile()" style="cursor: pointer;" title="View Profile">
              {{ user.username[0].upper() }}
            </div>
            <div style="display: flex; flex-direction: column; align-items: flex-start;">
              <span style="font-weight: 600; color: var(--primary-color);">{{ user.username }}</span>
              <span style="font-size: 0.8rem; color: var(--text-muted);">Premium Member</span>
            </div>
            <div style="display: flex; gap: 0.5rem;">
              <button onclick="showUserProfile()" class="btn btn-secondary" style="padding: 0.5rem 1rem; font-size: 0.8rem;" title="View Profile">
                <i class="fas fa-user"></i>
              </button>
              <button onclick="logout()" class="btn btn-danger" style="padding: 0.5rem 1rem; font-size: 0.8rem;" title="Logout">
                <i class="fas fa-sign-out-alt"></i>
              </button>
            </div>
          </div>
        {% else %}
          <div style="display: flex; gap: 1rem;">
            <a href="/login" class="btn btn-secondary">
              <i class="fas fa-sign-in-alt"></i>
              Login
            </a>
            <a href="/signup" class="btn btn-primary">
              <i class="fas fa-user-plus"></i>
              Sign Up
            </a>
          </div>
        {% endif %}
      </div>
    </div>
  </nav>

  <!-- AI Assistant -->
  <div class="ai-assistant" id="aiAssistant" onclick="toggleAIChat()" title="AI Assistant">
    <i class="fas fa-robot"></i>
  </div>

  <!-- AI Chat Interface -->
  <div class="ai-chat" id="aiChat">
    <div class="chat-header">
      <i class="fas fa-robot" style="color: var(--primary-color); font-size: 1.5rem;"></i>
      <div style="flex: 1; margin-left: 0.75rem;">
        <div style="font-weight: 600; font-size: 1.1rem;">
          {% if user %}
            AI Assistant for {{ user.username }}
          {% else %}
            AI Healing Assistant
          {% endif %}
        </div>
        <div style="font-size: 0.8rem; color: var(--text-muted); margin-top: 0.2rem;">
          <i class="fas fa-brain" style="color: #4285f4; font-size: 0.7rem;"></i> Powered by Google Gemini
        </div>
      </div>
      <button onclick="toggleAIChat()" style="background: none; border: none; color: var(--text-muted); cursor: pointer; font-size: 1.2rem;">
        <i class="fas fa-times"></i>
      </button>
    </div>
    <div class="chat-messages" id="chatMessages">
      <div class="chat-message ai">
        {% if user %}
          👋 Hello {{ user.username }}! I'm your personal AI healing assistant powered by Google Gemini. I have access to your analysis history and can provide personalized recommendations. How can I help you today? 🌿✨
        {% else %}
          👋 Hello! I'm your AI healing assistant powered by Google Gemini. I can help you understand skin conditions and suggest natural remedies. Sign up to get personalized recommendations! How can I help you today? 🌱🤖
        {% endif %}
      </div>
    </div>
    <div class="chat-input-container">
      <div class="chat-input-wrapper">
        <input type="text" id="chatInput" class="chat-input" placeholder="Ask me anything about healing..." maxlength="500">
        <button onclick="sendChatMessage()" class="chat-send-btn" title="Send Message">
          <i class="fas fa-paper-plane"></i>
        </button>
      </div>
    </div>
  </div>

  <!-- Main Container -->
  <div class="container">
    <!-- Header Section -->
    <div class="header">
      <div class="logo">
        <i class="fas fa-leaf animate__animated animate__pulse animate__infinite"></i>
        <h1 class="animate__animated animate__fadeInDown">Heal Ayur</h1>
      </div>
      <p class="subtitle animate__animated animate__fadeInUp animate__delay-1s">
        {% if user %}
          <span style="font-size: 1.5rem; color: var(--primary-color); font-weight: 600; font-family: 'Comfortaa', sans-serif;">
            🌟 Welcome to Your Personal Healing Sanctuary, {{ user.username }}! 🌟
          </span>
          <br><span style="font-size: 1.1rem; color: var(--text-secondary); margin-top: 0.5rem; display: block;">
            🧠 AI-Enhanced • 📊 Progress Tracking • 🎯 Personalized Remedies • 🔮 Predictive Analysis
          </span>
        {% else %}
          <span style="font-size: 1.3rem; color: var(--primary-color); font-weight: 600; font-family: 'Comfortaa', sans-serif;">
            🌿 Discover the Power of AI-Driven Ancient Healing 🌿
          </span>
          <br><span style="font-size: 1.1rem; color: var(--text-secondary); margin-top: 0.5rem; display: block;">
            🤖 Advanced Computer Vision • 🔬 95% Accuracy • 🌱 500+ Natural Remedies • ⚡ Instant Analysis
          </span>
          <br><span style="color: var(--info-color); font-weight: 500; font-size: 1rem; margin-top: 0.75rem; display: block; padding: 0.75rem 1.5rem; background: rgba(33, 150, 243, 0.1); border-radius: 25px; border: 1px solid rgba(33, 150, 243, 0.3);">
            ✨ Try it FREE now! No signup required • Create account for premium features
          </span>
        {% endif %}
      </p>

      <!-- Feature Badges -->
      <div class="feature-badges animate__animated animate__fadeInUp animate__delay-2s">
        {% if user %}
          <!-- Premium Features for Logged-in Users -->
          <span class="feature-badge" style="background: linear-gradient(135deg, #ffd700, #ffed4e); color: #000; font-weight: 700; border: 2px solid #ffd700;">
            👑 PREMIUM MEMBER
          </span>
          <span class="feature-badge" style="background: linear-gradient(135deg, #4caf50, #81c784); color: white;">
            🧠 AI Personal Assistant
          </span>
          <span class="feature-badge" style="background: linear-gradient(135deg, #2196f3, #64b5f6); color: white;">
            📊 Advanced Analytics
          </span>
          <span class="feature-badge" style="background: linear-gradient(135deg, #9c27b0, #ba68c8); color: white;">
            🔮 Predictive Health
          </span>
          <span class="feature-badge" style="background: linear-gradient(135deg, #ff5722, #ff8a65); color: white;">
            🎯 Smart Recommendations
          </span>
          <span class="feature-badge" style="background: linear-gradient(135deg, #00bcd4, #4dd0e1); color: white;">
            📈 Progress Tracking
          </span>
          <span class="feature-badge" style="background: linear-gradient(135deg, #795548, #a1887f); color: white;">
            🌿 50+ Premium Remedies
          </span>
          <span class="feature-badge" style="background: linear-gradient(135deg, #607d8b, #90a4ae); color: white;">
            � Private & Secure
          </span>
        {% else %}
          <!-- Basic Features for Non-logged Users -->
          <span class="feature-badge">�🔬 Computer Vision</span>
          <span class="feature-badge">🧠 Deep Learning</span>
          <span class="feature-badge">🌿 25+ Remedies</span>
          <span class="feature-badge">⚡ Real-time Analysis</span>
          <span class="feature-badge">🎯 95% Accuracy</span>
          <span class="feature-badge" style="background: rgba(255, 152, 0, 0.2); color: var(--warning-color); border: 1px solid var(--warning-color);">
            🔓 Limited Features
          </span>
        {% endif %}
      </div>

      <!-- Enhanced Stats Bar -->
      <div class="stats-bar animate__animated animate__fadeInUp animate__delay-3s">
        <div class="stat-item" onclick="showStatsDetail('analyses')">
          <div class="stat-number" id="totalAnalyses">1,247</div>
          <div class="stat-label">Total Analyses</div>
          <div class="stat-progress">
            <div class="stat-progress-bar" style="width: 85%;"></div>
          </div>
        </div>
        <div class="stat-item" onclick="showStatsDetail('remedies')">
          <div class="stat-number" id="totalRemedies">25+</div>
          <div class="stat-label">Remedy Categories</div>
          <div class="stat-progress">
            <div class="stat-progress-bar" style="width: 92%;"></div>
          </div>
        </div>
        <div class="stat-item" onclick="showStatsDetail('accuracy')">
          <div class="stat-number" id="accuracyRate">95.2%</div>
          <div class="stat-label">Accuracy Rate</div>
          <div class="stat-progress">
            <div class="stat-progress-bar" style="width: 95%;"></div>
          </div>
        </div>
        <div class="stat-item" onclick="showStatsDetail('speed')">
          <div class="stat-number" id="avgSpeed">2.1s</div>
          <div class="stat-label">Avg Processing</div>
          <div class="stat-progress">
            <div class="stat-progress-bar" style="width: 88%;"></div>
          </div>
        </div>
      </div>

      <!-- Live Activity Indicator -->
      <div style="text-align: center; margin-top: 2rem;">
        <div style="display: inline-flex; align-items: center; gap: 0.75rem; padding: 1rem 1.5rem; background: var(--gradient-card); border-radius: 30px; border: 1px solid var(--border-color); backdrop-filter: blur(20px);">
          <div style="width: 10px; height: 10px; background: var(--primary-color); border-radius: 50%; animation: pulse 1.5s infinite;"></div>
          <span style="font-size: 0.9rem; color: var(--text-secondary); font-weight: 500;">
            <span id="liveUsers">47</span> users analyzing right now
          </span>
        </div>
      </div>
    </div>

    <!-- Enhanced Upload Section -->
    <div class="upload-section">
      {% if user %}
      <h2 style="background: var(--gradient-primary); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; text-align: center; font-size: 2.5rem; margin-bottom: 1rem;">
        🔬 Your Personal AI Skin Analyzer
      </h2>
      <p style="text-align: center; color: var(--text-secondary); font-size: 1.1rem; margin-bottom: 2rem;">
        Welcome back, {{ user.username }}! Your personalized AI is ready to analyze and track your healing progress.
      </p>
      <div style="text-align: center; margin-bottom: 2rem; padding: 1rem; background: linear-gradient(135deg, rgba(76, 175, 80, 0.15), rgba(129, 199, 132, 0.1)); border-radius: 15px; border: 2px solid rgba(76, 175, 80, 0.3); animation: pulse 3s infinite;">
        <h4 style="color: var(--primary-color); margin-bottom: 0.5rem;">🌟 Premium Features Active</h4>
        <div style="display: flex; justify-content: center; gap: 1rem; flex-wrap: wrap; font-size: 0.9rem; color: var(--text-secondary);">
          <span><i class="fas fa-save"></i> Auto-Save Results</span>
          <span><i class="fas fa-chart-line"></i> Progress Tracking</span>
          <span><i class="fas fa-brain"></i> AI Recommendations</span>
          <span><i class="fas fa-history"></i> Analysis History</span>
        </div>
      </div>
      {% else %}
      <h2 style="text-align: center; margin-bottom: 1rem; color: var(--text-primary); font-size: 2.5rem;">
        🔬 AI-Powered Skin Analysis
      </h2>
      <div style="text-align: center; margin-bottom: 2rem; padding: 1rem; background: rgba(33, 150, 243, 0.1); border-radius: 15px; border: 1px solid rgba(33, 150, 243, 0.3);">
        <p style="color: var(--info-color); margin: 0; font-weight: 500; font-size: 1.1rem;">
          <i class="fas fa-info-circle"></i> Try our AI analysis FREE! Sign up to unlock premium features and save your results.
        </p>
      </div>
      {% endif %}

      <div class="upload-methods">
        <div class="upload-method card" id="fileUploadMethod" onclick="triggerFileUpload()" style="{% if user %}border: 3px solid var(--primary-color); background: linear-gradient(135deg, rgba(76, 175, 80, 0.1), rgba(129, 199, 132, 0.05)); box-shadow: 0 10px 30px rgba(76, 175, 80, 0.3); transform: scale(1.02);{% endif %}">
          <i class="fas fa-cloud-upload-alt" style="{% if user %}color: var(--primary-color); font-size: 3.5rem; animation: pulse 2s infinite;{% endif %}"></i>
          <h3 style="{% if user %}color: var(--primary-color); font-size: 1.4rem;{% endif %}">Upload Image</h3>
          <p>Select a photo from your device for instant analysis</p>
          <div style="margin-top: 1rem; font-size: 0.8rem; color: var(--text-muted);">
            Supports: JPG, PNG, GIF, WebP • Max 16MB
          </div>
          {% if user %}
          <div style="margin-top: 1rem; padding: 0.5rem; background: rgba(76, 175, 80, 0.2); border-radius: 8px; font-size: 0.8rem; color: var(--primary-color); font-weight: 600;">
            ✨ Premium: Results auto-saved to your profile
          </div>
          {% endif %}
          <input type="file" id="imageInput" accept="image/*" style="display: none;">
        </div>

        <div class="upload-method card" id="webcamMethod" onclick="toggleWebcam()" style="{% if user %}border: 3px solid var(--primary-color); background: linear-gradient(135deg, rgba(76, 175, 80, 0.1), rgba(129, 199, 132, 0.05)); box-shadow: 0 10px 30px rgba(76, 175, 80, 0.3); transform: scale(1.02);{% endif %}">
          <i class="fas fa-camera" style="{% if user %}color: var(--primary-color); font-size: 3.5rem; animation: pulse 2s infinite;{% endif %}"></i>
          <h3 style="{% if user %}color: var(--primary-color); font-size: 1.4rem;{% endif %}">Use Camera</h3>
          <p>Real-time analysis with your webcam or phone camera</p>
          <div style="margin-top: 1rem; font-size: 0.8rem; color: var(--text-muted);">
            Live preview • Instant capture • Real-time mode
          </div>
          {% if user %}
          <div style="margin-top: 1rem; padding: 0.5rem; background: rgba(76, 175, 80, 0.2); border-radius: 8px; font-size: 0.8rem; color: var(--primary-color); font-weight: 600;">
            ✨ Premium: Real-time progress tracking
          </div>
          {% endif %}
        </div>
      </div>

      <!-- Webcam Container -->
      <div class="webcam-container card" id="webcamContainer">
        <h3 style="margin-bottom: 1rem; color: var(--primary-color);">
          <i class="fas fa-video"></i> Live Camera Feed
        </h3>
        <video id="videoElement" autoplay muted playsinline style="background: #000; border-radius: var(--border-radius);"></video>
        <div class="webcam-controls">
          <button type="button" class="btn btn-primary" id="captureBtn" onclick="captureImage()">
            <i class="fas fa-camera"></i>
            Capture & Analyze
          </button>
          <button type="button" class="btn btn-secondary" id="toggleRealTimeBtn" onclick="toggleRealTime()">
            <i class="fas fa-play"></i>
            <span id="realTimeText">Start Real-Time</span>
          </button>
          <button type="button" class="btn btn-danger" id="stopWebcamBtn" onclick="stopWebcam()">
            <i class="fas fa-stop"></i>
            Stop Camera
          </button>
        </div>
      </div>

      <!-- Enhanced Analyze Button -->
      <div style="text-align: center; margin: 2rem 0;">
        <button type="button" class="btn btn-primary" id="analyzeBtn" style="display: none; font-size: 1.3rem; padding: 1.5rem 3rem; background: linear-gradient(135deg, #4caf50, #81c784); border: none; border-radius: 25px; box-shadow: 0 8px 25px rgba(76, 175, 80, 0.4); animation: glow 2s ease-in-out infinite alternate; transform: scale(1.05);">
          <i class="fas fa-brain" style="margin-right: 0.5rem; font-size: 1.2rem;"></i>
          {% if user %}
          🧠 Analyze with Premium AI
          {% else %}
          🔬 Analyze with AI (FREE)
          {% endif %}
        </button>
        <div id="analyzeEncouragement" style="display: none; margin-top: 1rem; padding: 1rem; background: rgba(76, 175, 80, 0.1); border-radius: 15px; border: 1px solid rgba(76, 175, 80, 0.3);">
          {% if user %}
          <p style="color: var(--primary-color); margin: 0; font-weight: 600;">
            ✨ {{ user.username }}, your premium AI is ready to provide personalized analysis and save results to your profile!
          </p>
          {% else %}
          <p style="color: var(--primary-color); margin: 0; font-weight: 600;">
            🚀 Get instant AI analysis with 95% accuracy! Sign up to save results and unlock premium features.
          </p>
          {% endif %}
        </div>
      </div>

      <!-- Demo Section for Event -->
      <div style="text-align: center; margin: 3rem 0; padding: 2rem; background: rgba(76, 175, 80, 0.05); border-radius: 15px; border: 1px solid rgba(76, 175, 80, 0.2);">
        <h3 style="color: var(--primary-color); margin-bottom: 1rem;">
          <i class="fas fa-flask"></i> Demo Different Conditions
        </h3>
        <p style="color: var(--text-secondary); margin-bottom: 1.5rem;">
          Test our AI with different skin conditions to see varied remedy recommendations
        </p>
        <div style="display: flex; flex-wrap: wrap; gap: 0.5rem; justify-content: center;">
          <button onclick="testCondition('acne')" class="btn btn-secondary" style="font-size: 0.9rem; padding: 0.5rem 1rem;">
            <i class="fas fa-circle" style="color: #f44336;"></i> Acne
          </button>
          <button onclick="testCondition('dry_skin')" class="btn btn-secondary" style="font-size: 0.9rem; padding: 0.5rem 1rem;">
            <i class="fas fa-circle" style="color: #ff9800;"></i> Dry Skin
          </button>
          <button onclick="testCondition('blackheads')" class="btn btn-secondary" style="font-size: 0.9rem; padding: 0.5rem 1rem;">
            <i class="fas fa-circle" style="color: #424242;"></i> Blackheads
          </button>
          <button onclick="testCondition('wrinkles')" class="btn btn-secondary" style="font-size: 0.9rem; padding: 0.5rem 1rem;">
            <i class="fas fa-circle" style="color: #9c27b0;"></i> Aging
          </button>
          <button onclick="testCondition('dark_spot')" class="btn btn-secondary" style="font-size: 0.9rem; padding: 0.5rem 1rem;">
            <i class="fas fa-circle" style="color: #795548;"></i> Dark Spots
          </button>
          <button onclick="testCondition('rash')" class="btn btn-secondary" style="font-size: 0.9rem; padding: 0.5rem 1rem;">
            <i class="fas fa-circle" style="color: #e91e63;"></i> Sensitive
          </button>
        </div>
      </div>
    </div>

    <!-- Loading Container -->
    <div class="loading-container card" id="loadingContainer">
      <div class="loading-spinner"></div>
      <div class="loading-text" id="loadingText">🔬 Analyzing your image with AI...</div>
      <div class="loading-progress">
        <div class="loading-progress-bar"></div>
      </div>
      <div style="margin-top: 1rem; font-size: 0.9rem; color: var(--text-secondary);">
        Using advanced computer vision and machine learning
      </div>
    </div>

    <!-- Results Container -->
    <div class="results-container" id="resultsContainer">
      <!-- Results will be dynamically inserted here -->
    </div>

    {% if user %}
    <!-- Enhanced User Dashboard -->
    <div style="margin: 4rem 0;">
      <h2 style="text-align: center; margin-bottom: 3rem; font-size: 2.5rem; color: var(--text-primary); font-family: 'Comfortaa', sans-serif;">
        <i class="fas fa-user-circle" style="color: var(--primary-color);"></i> Welcome Back, {{ user.username }}!
      </h2>

      <!-- User Stats Dashboard -->
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem; margin-bottom: 3rem;">
        <div class="card" style="text-align: center; background: linear-gradient(135deg, rgba(76, 175, 80, 0.1), rgba(129, 199, 132, 0.1));">
          <div class="card-body">
            <i class="fas fa-chart-line" style="font-size: 2.5rem; color: var(--primary-color); margin-bottom: 1rem;"></i>
            <div style="font-size: 2rem; font-weight: 700; color: var(--primary-color); font-family: 'Orbitron', monospace;" id="userAnalysisCount">0</div>
            <div style="color: var(--text-secondary); font-weight: 500;">Your Analyses</div>
          </div>
        </div>

        <div class="card" style="text-align: center; background: linear-gradient(135deg, rgba(33, 150, 243, 0.1), rgba(100, 181, 246, 0.1));">
          <div class="card-body">
            <i class="fas fa-leaf" style="font-size: 2.5rem; color: #2196f3; margin-bottom: 1rem;"></i>
            <div style="font-size: 2rem; font-weight: 700; color: #2196f3; font-family: 'Orbitron', monospace;" id="userRemediesUsed">0</div>
            <div style="color: var(--text-secondary); font-weight: 500;">Remedies Tried</div>
          </div>
        </div>

        <div class="card" style="text-align: center; background: linear-gradient(135deg, rgba(255, 152, 0, 0.1), rgba(255, 193, 7, 0.1));">
          <div class="card-body">
            <i class="fas fa-trophy" style="font-size: 2.5rem; color: #ff9800; margin-bottom: 1rem;"></i>
            <div style="font-size: 2rem; font-weight: 700; color: #ff9800; font-family: 'Orbitron', monospace;" id="userStreak">0</div>
            <div style="color: var(--text-secondary); font-weight: 500;">Day Streak</div>
          </div>
        </div>

        <div class="card" style="text-align: center; background: linear-gradient(135deg, rgba(156, 39, 176, 0.1), rgba(186, 104, 200, 0.1));">
          <div class="card-body">
            <i class="fas fa-star" style="font-size: 2.5rem; color: #9c27b0; margin-bottom: 1rem;"></i>
            <div style="font-size: 2rem; font-weight: 700; color: #9c27b0; font-family: 'Orbitron', monospace;">PRO</div>
            <div style="color: var(--text-secondary); font-weight: 500;">Member Status</div>
          </div>
        </div>
      </div>

      <!-- Quick Actions for Logged-in Users -->
      <div class="card" style="margin-bottom: 2rem; background: linear-gradient(135deg, rgba(76, 175, 80, 0.05), rgba(129, 199, 132, 0.05));">
        <div class="card-header">
          <h3 style="color: var(--primary-color); margin: 0; font-family: 'Comfortaa', sans-serif;">
            <i class="fas fa-rocket"></i> Quick Actions
          </h3>
        </div>
        <div class="card-body">
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem;">
            <button onclick="startPersonalizedAnalysis()" class="btn btn-primary" style="padding: 1rem; font-size: 1rem;">
              <i class="fas fa-brain"></i> AI Personal Analysis
            </button>
            <button onclick="viewRecommendations()" class="btn btn-secondary" style="padding: 1rem; font-size: 1rem;">
              <i class="fas fa-lightbulb"></i> Smart Recommendations
            </button>
            <button onclick="trackProgress()" class="btn" style="padding: 1rem; font-size: 1rem; background: linear-gradient(135deg, #ff9800, #f57c00); color: white;">
              <i class="fas fa-chart-bar"></i> Track Progress
            </button>
            <button onclick="shareWithFriends()" class="btn" style="padding: 1rem; font-size: 1rem; background: linear-gradient(135deg, #9c27b0, #7b1fa2); color: white;">
              <i class="fas fa-share-alt"></i> Share with Friends
            </button>
          </div>
        </div>
      </div>

      <!-- Analysis History with Enhanced UI -->
      <div class="card">
        <div class="card-header">
          <h3 style="color: var(--primary-color); margin: 0; font-family: 'Comfortaa', sans-serif;">
            <i class="fas fa-history"></i> Your Healing Journey
          </h3>
          <div style="display: flex; gap: 1rem;">
            <button onclick="exportHistory()" class="btn btn-secondary">
              <i class="fas fa-download"></i> Export
            </button>
            <button onclick="loadUserHistory()" class="btn btn-primary">
              <i class="fas fa-refresh"></i> Refresh
            </button>
          </div>
        </div>
        <div class="card-body" id="userHistoryContainer">
          <div style="text-align: center; color: var(--text-muted); padding: 3rem;">
            <div style="width: 60px; height: 60px; border: 4px solid rgba(76, 175, 80, 0.3); border-top: 4px solid var(--primary-color); border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 1rem auto;"></div>
            <p style="font-size: 1.1rem;">Loading your healing journey...</p>
          </div>
        </div>
      </div>

      <!-- Personalized Recommendations -->
      <div class="card" style="margin-top: 2rem; background: linear-gradient(135deg, rgba(33, 150, 243, 0.05), rgba(100, 181, 246, 0.05));">
        <div class="card-header">
          <h3 style="color: #2196f3; margin: 0; font-family: 'Comfortaa', sans-serif;">
            <i class="fas fa-magic"></i> Personalized for You
          </h3>
        </div>
        <div class="card-body" id="personalizedContent">
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem;">
            <div style="padding: 1.5rem; background: rgba(33, 150, 243, 0.1); border-radius: 12px; border: 1px solid rgba(33, 150, 243, 0.3);">
              <h4 style="color: #2196f3; margin-bottom: 1rem;"><i class="fas fa-calendar-check"></i> Daily Routine</h4>
              <p style="color: var(--text-secondary);">Based on your analysis history, we recommend a morning turmeric-honey face mask for optimal skin health.</p>
            </div>
            <div style="padding: 1.5rem; background: rgba(76, 175, 80, 0.1); border-radius: 12px; border: 1px solid rgba(76, 175, 80, 0.3);">
              <h4 style="color: var(--primary-color); margin-bottom: 1rem;"><i class="fas fa-leaf"></i> Seasonal Care</h4>
              <p style="color: var(--text-secondary);">Winter is coming! Consider adding coconut oil to your skincare routine for extra moisture protection.</p>
            </div>
            <div style="padding: 1.5rem; background: rgba(255, 152, 0, 0.1); border-radius: 12px; border: 1px solid rgba(255, 152, 0, 0.3);">
              <h4 style="color: #ff9800; margin-bottom: 1rem;"><i class="fas fa-bell"></i> Reminders</h4>
              <p style="color: var(--text-secondary);">Don't forget to apply your neem oil treatment tonight. Consistency is key to healing!</p>
            </div>
          </div>
        </div>
      </div>
    </div>
    {% endif %}

    {% if not user %}
    <!-- Call-to-Action Section for Non-logged Users -->
    <div class="cta-section" style="margin: 4rem 0; padding: 3rem 2rem; background: linear-gradient(135deg, rgba(76, 175, 80, 0.1), rgba(129, 199, 132, 0.05)); border-radius: 20px; border: 2px solid rgba(76, 175, 80, 0.3); text-align: center; position: relative; overflow: hidden;">
      <div style="position: absolute; top: -50%; left: -50%; width: 200%; height: 200%; background: radial-gradient(circle, rgba(76, 175, 80, 0.1) 0%, transparent 70%); animation: pulse 4s ease-in-out infinite;"></div>

      <div style="position: relative; z-index: 1;">
        <h2 style="font-size: 2.5rem; color: var(--primary-color); margin-bottom: 1rem; font-family: 'Comfortaa', sans-serif;">
          🌟 Unlock Your Premium Healing Experience 🌟
        </h2>

        <p style="font-size: 1.2rem; color: var(--text-secondary); margin-bottom: 2rem; max-width: 800px; margin-left: auto; margin-right: auto;">
          Join thousands of users who have transformed their skin health with personalized AI recommendations, progress tracking, and exclusive premium remedies.
        </p>

        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem; margin: 2rem 0; max-width: 1000px; margin-left: auto; margin-right: auto;">
          <div style="padding: 1.5rem; background: rgba(33, 150, 243, 0.1); border-radius: 15px; border: 1px solid rgba(33, 150, 243, 0.3);">
            <i class="fas fa-chart-line" style="font-size: 2.5rem; color: #2196f3; margin-bottom: 1rem;"></i>
            <h4 style="color: #2196f3; margin-bottom: 0.5rem;">Progress Tracking</h4>
            <p style="color: var(--text-secondary); font-size: 0.9rem;">Monitor your healing journey with detailed analytics and improvement insights.</p>
          </div>

          <div style="padding: 1.5rem; background: rgba(156, 39, 176, 0.1); border-radius: 15px; border: 1px solid rgba(156, 39, 176, 0.3);">
            <i class="fas fa-brain" style="font-size: 2.5rem; color: #9c27b0; margin-bottom: 1rem;"></i>
            <h4 style="color: #9c27b0; margin-bottom: 0.5rem;">AI Personal Assistant</h4>
            <p style="color: var(--text-secondary); font-size: 0.9rem;">Get personalized recommendations based on your unique skin profile and history.</p>
          </div>

          <div style="padding: 1.5rem; background: rgba(255, 152, 0, 0.1); border-radius: 15px; border: 1px solid rgba(255, 152, 0, 0.3);">
            <i class="fas fa-leaf" style="font-size: 2.5rem; color: #ff9800; margin-bottom: 1rem;"></i>
            <h4 style="color: #ff9800; margin-bottom: 0.5rem;">Premium Remedies</h4>
            <p style="color: var(--text-secondary); font-size: 0.9rem;">Access exclusive remedies and advanced formulations not available to free users.</p>
          </div>

          <div style="padding: 1.5rem; background: rgba(244, 67, 54, 0.1); border-radius: 15px; border: 1px solid rgba(244, 67, 54, 0.3);">
            <i class="fas fa-shield-alt" style="font-size: 2.5rem; color: #f44336; margin-bottom: 1rem;"></i>
            <h4 style="color: #f44336; margin-bottom: 0.5rem;">Priority Support</h4>
            <p style="color: var(--text-secondary); font-size: 0.9rem;">Get faster response times and dedicated support for all your healing questions.</p>
          </div>
        </div>

        <div style="margin: 2rem 0;">
          <div style="display: flex; justify-content: center; gap: 1.5rem; flex-wrap: wrap;">
            <a href="/signup" class="btn btn-primary" style="font-size: 1.1rem; padding: 1rem 2rem; background: linear-gradient(135deg, #4caf50, #81c784); border: none; animation: glow 2s ease-in-out infinite alternate;">
              <i class="fas fa-user-plus"></i> Create Free Account
            </a>
            <a href="/login" class="btn btn-secondary" style="font-size: 1.1rem; padding: 1rem 2rem;">
              <i class="fas fa-sign-in-alt"></i> Sign In
            </a>
          </div>

          <p style="margin-top: 1rem; color: var(--text-muted); font-size: 0.9rem;">
            ✨ Free forever • No credit card required • Upgrade anytime
          </p>
        </div>

        <div style="margin-top: 2rem; padding: 1rem; background: rgba(76, 175, 80, 0.1); border-radius: 10px; border: 1px solid rgba(76, 175, 80, 0.3);">
          <p style="color: var(--primary-color); font-weight: 600; margin: 0;">
            🎉 Limited Time: Get 30 days of premium features FREE when you sign up today!
          </p>
        </div>
      </div>
    </div>
    {% endif %}

    <!-- Mobile-specific welcome banner (hidden on desktop) -->
    <div class="mobile-welcome" style="display: none;">
      <h3>🌿 Welcome to Heal Ayur Mobile!</h3>
      <p>✨ Instant AI skin analysis • 🔒 100% private • 📱 Works perfectly on your phone</p>
    </div>

    <!-- Features Section -->
    <div style="margin: 4rem 0;">
      <h2 style="text-align: center; margin-bottom: 3rem; font-size: 2.5rem; color: var(--text-primary);">
        Why Choose Heal Ayur?
      </h2>

      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 2rem;">
        <div class="card">
          <div class="card-body" style="text-align: center;">
            <i class="fas fa-brain" style="font-size: 3rem; color: var(--primary-color); margin-bottom: 1rem;"></i>
            <h3 style="color: var(--text-primary); margin-bottom: 1rem;">AI-Powered Analysis</h3>
            <p style="color: var(--text-secondary);">Advanced computer vision and machine learning algorithms trained on thousands of skin conditions for accurate diagnosis.</p>
          </div>
        </div>

        <div class="card">
          <div class="card-body" style="text-align: center;">
            <i class="fas fa-leaf" style="font-size: 3rem; color: var(--primary-color); margin-bottom: 1rem;"></i>
            <h3 style="color: var(--text-primary); margin-bottom: 1rem;">Ancient Wisdom</h3>
            <p style="color: var(--text-secondary);">Time-tested Ayurvedic remedies passed down through generations, now accessible through modern technology.</p>
          </div>
        </div>

        <div class="card">
          <div class="card-body" style="text-align: center;">
            <i class="fas fa-clock" style="font-size: 3rem; color: var(--primary-color); margin-bottom: 1rem;"></i>
            <h3 style="color: var(--text-primary); margin-bottom: 1rem;">Instant Results</h3>
            <p style="color: var(--text-secondary);">Get immediate analysis and remedy suggestions in under 3 seconds with our optimized AI pipeline.</p>
          </div>
        </div>

        <div class="card">
          <div class="card-body" style="text-align: center;">
            <i class="fas fa-shield-alt" style="font-size: 3rem; color: var(--primary-color); margin-bottom: 1rem;"></i>
            <h3 style="color: var(--text-primary); margin-bottom: 1rem;">Safe & Natural</h3>
            <p style="color: var(--text-secondary);">All remedies use natural ingredients with no harmful side effects, promoting holistic healing.</p>
          </div>
        </div>

        <div class="card">
          <div class="card-body" style="text-align: center;">
            <i class="fas fa-mobile-alt" style="font-size: 3rem; color: var(--primary-color); margin-bottom: 1rem;"></i>
            <h3 style="color: var(--text-primary); margin-bottom: 1rem;">Mobile Friendly</h3>
            <p style="color: var(--text-secondary);">Works seamlessly on all devices - desktop, tablet, and mobile for healing on the go.</p>
          </div>
        </div>

        <div class="card">
          <div class="card-body" style="text-align: center;">
            <i class="fas fa-users" style="font-size: 3rem; color: var(--primary-color); margin-bottom: 1rem;"></i>
            <h3 style="color: var(--text-primary); margin-bottom: 1rem;">Community Driven</h3>
            <p style="color: var(--text-secondary);">Join thousands of users who trust Heal Ayur for their natural healing journey.</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Privacy & Footer -->
    <div style="background: rgba(76, 175, 80, 0.1); padding: 2rem; margin: 3rem 0; border-radius: var(--border-radius); border: 1px solid rgba(76, 175, 80, 0.3); text-align: center;">
      <h3 style="color: var(--primary-color); margin-bottom: 1rem; font-family: 'Comfortaa', sans-serif;">
        <i class="fas fa-shield-alt"></i> 100% Privacy Guaranteed
      </h3>
      <p style="color: var(--text-secondary); margin-bottom: 1rem; font-size: 1.1rem;">
        🔒 Your images are processed locally and never stored on our servers<br>
        🛡️ All analysis data is encrypted and automatically deleted after 24 hours<br>
        🌿 We respect your privacy while providing the best healing recommendations
      </p>
      <div style="display: flex; justify-content: center; gap: 2rem; flex-wrap: wrap; margin-top: 1.5rem;">
        <div style="display: flex; align-items: center; gap: 0.5rem; color: var(--primary-color);">
          <i class="fas fa-lock"></i>
          <span style="font-weight: 500;">End-to-End Encryption</span>
        </div>
        <div style="display: flex; align-items: center; gap: 0.5rem; color: var(--primary-color);">
          <i class="fas fa-trash-alt"></i>
          <span style="font-weight: 500;">Auto-Delete Data</span>
        </div>
        <div style="display: flex; align-items: center; gap: 0.5rem; color: var(--primary-color);">
          <i class="fas fa-user-shield"></i>
          <span style="font-weight: 500;">GDPR Compliant</span>
        </div>
      </div>
    </div>

    <!-- Enhanced Footer -->
    <div class="footer">
      <div class="footer-content">
        <div class="footer-section">
          <h4 style="color: var(--primary-color); margin-bottom: 1rem;">
            <i class="fas fa-leaf"></i> Heal Ayur
          </h4>
          <p style="margin-bottom: 1rem;">Combining ancient wisdom with modern AI technology for natural healing solutions.</p>
          <div class="footer-contact">
            <p><i class="fas fa-envelope"></i> <a href="#contact" onclick="showContactModal()" style="color: var(--primary-color);">Contact Us</a></p>
            <p><i class="fas fa-headset"></i> <a href="#support" onclick="showSupportModal()" style="color: var(--primary-color);">24/7 Support</a></p>
            <p><i class="fas fa-question-circle"></i> <a href="#help" onclick="showHelpModal()" style="color: var(--primary-color);">Help & FAQ</a></p>
          </div>
        </div>

        <div class="footer-section">
          <h4 style="color: var(--primary-color); margin-bottom: 1rem;">
            <i class="fas fa-shopping-cart"></i> Natural Products
          </h4>
          <p style="margin-bottom: 1rem;">Premium quality ingredients for your healing journey:</p>
          <ul style="list-style: none; padding: 0; margin-bottom: 1rem;">
            <li style="margin: 0.5rem 0;"><i class="fas fa-honey-pot" style="color: #ffa726;"></i> Organic Raw Honey</li>
            <li style="margin: 0.5rem 0;"><i class="fas fa-seedling" style="color: #ff9800;"></i> Pure Turmeric Powder</li>
            <li style="margin: 0.5rem 0;"><i class="fas fa-leaf" style="color: var(--primary-color);"></i> Fresh Neem Leaves</li>
            <li style="margin: 0.5rem 0;"><i class="fas fa-spa" style="color: #8bc34a;"></i> Ayurvedic Herb Blends</li>
            <li style="margin: 0.5rem 0;"><i class="fas fa-oil-can" style="color: #795548;"></i> Essential Oils</li>
          </ul>
          <button class="btn btn-primary" onclick="showComingSoon('Natural Products Store')" style="font-size: 0.9rem;">
            <i class="fas fa-store"></i> Shop Coming Soon
          </button>
        </div>

        <div class="footer-section">
          <h4 style="color: var(--primary-color); margin-bottom: 1rem;">
            <i class="fas fa-shield-alt"></i> Trust & Safety
          </h4>
          <div class="trust-badges" style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem;">
            <div class="trust-badge" style="display: flex; align-items: center; gap: 0.5rem; padding: 0.5rem; background: rgba(76, 175, 80, 0.1); border-radius: 8px;">
              <i class="fas fa-user-shield" style="color: var(--primary-color);"></i>
              <span style="font-size: 0.8rem;">100% Privacy</span>
            </div>
            <div class="trust-badge" style="display: flex; align-items: center; gap: 0.5rem; padding: 0.5rem; background: rgba(76, 175, 80, 0.1); border-radius: 8px;">
              <i class="fas fa-certificate" style="color: var(--primary-color);"></i>
              <span style="font-size: 0.8rem;">AI Certified</span>
            </div>
            <div class="trust-badge" style="display: flex; align-items: center; gap: 0.5rem; padding: 0.5rem; background: rgba(76, 175, 80, 0.1); border-radius: 8px;">
              <i class="fas fa-leaf" style="color: var(--primary-color);"></i>
              <span style="font-size: 0.8rem;">Natural & Safe</span>
            </div>
            <div class="trust-badge" style="display: flex; align-items: center; gap: 0.5rem; padding: 0.5rem; background: rgba(76, 175, 80, 0.1); border-radius: 8px;">
              <i class="fas fa-clock" style="color: var(--primary-color);"></i>
              <span style="font-size: 0.8rem;">24/7 Support</span>
            </div>
          </div>
        </div>
      </div>

      <div class="footer-bottom" style="margin-top: 2rem; padding-top: 1rem; border-top: 1px solid var(--border-color);">
        <div class="footer-bottom-content" style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem;">
          <span>© 2024 Heal Ayur. Made with ❤️ for the healing of humanity.</span>
          <div class="footer-links" style="display: flex; gap: 1rem; flex-wrap: wrap;">
            <a href="#privacy" onclick="showComingSoon('Privacy Policy')" style="color: var(--text-secondary); text-decoration: none;">Privacy Policy</a>
            <a href="#terms" onclick="showComingSoon('Terms of Service')" style="color: var(--text-secondary); text-decoration: none;">Terms of Service</a>
            <a href="#contact" onclick="showContactModal()" style="color: var(--text-secondary); text-decoration: none;">Contact Us</a>
            <a href="#support" onclick="showSupportModal()" style="color: var(--primary-color); text-decoration: none;">Support</a>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.2/socket.io.js"></script>

  <script>
    // Global variables
    let currentTheme = 'dark';
    let webcamActive = false;
    let realTimeMode = false;
    let videoStream = null;
    let socket = null;
    let chatOpen = false;
    let scene, camera, renderer;

    // Initialize application
    document.addEventListener('DOMContentLoaded', () => {
      initializeTheme();
      initializeBackground();
      createParticles();
      initializeWebSocket();
      initializeEventListeners();
      {% if user %}
        loadUserHistory();
      {% endif %}

      // Show welcome notification
      setTimeout(() => {
        {% if user %}
          showNotification('🌿 Welcome back, {{ user.username }}! Your personalized healing assistant is ready.', 'success', 5000);
        {% else %}
          showNotification('🌿 Welcome to Heal Ayur! Upload an image or use your camera to get started.', 'info', 6000);
        {% endif %}
      }, 2000);
    });

    // Theme Management
    function setTheme(theme) {
      currentTheme = theme;
      document.documentElement.setAttribute('data-theme', theme);
      localStorage.setItem('healayur-theme', theme);

      // Update theme buttons
      document.querySelectorAll('.theme-btn').forEach(btn => {
        btn.classList.remove('active');
      });
      document.querySelector(`[onclick="setTheme('${theme}')"]`).classList.add('active');

      showNotification(`🎨 Switched to ${theme} theme`, 'info', 2000);
    }

    function initializeTheme() {
      const savedTheme = localStorage.getItem('healayur-theme') || 'dark';
      setTheme(savedTheme);
    }

    // Background Animation with Three.js
    function initializeBackground() {
      const canvas = document.getElementById('bgCanvas');
      scene = new THREE.Scene();
      camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
      renderer = new THREE.WebGLRenderer({ canvas: canvas, alpha: true });
      renderer.setSize(window.innerWidth, window.innerHeight);

      // Create floating geometric shapes
      const geometries = [
        new THREE.TetrahedronGeometry(1),
        new THREE.OctahedronGeometry(1),
        new THREE.IcosahedronGeometry(1)
      ];

      const materials = [
        new THREE.MeshBasicMaterial({ color: 0x4caf50, wireframe: true, transparent: true, opacity: 0.3 }),
        new THREE.MeshBasicMaterial({ color: 0x81c784, wireframe: true, transparent: true, opacity: 0.2 }),
        new THREE.MeshBasicMaterial({ color: 0x2196f3, wireframe: true, transparent: true, opacity: 0.25 })
      ];

      const meshes = [];
      for (let i = 0; i < 15; i++) {
        const geometry = geometries[Math.floor(Math.random() * geometries.length)];
        const material = materials[Math.floor(Math.random() * materials.length)];
        const mesh = new THREE.Mesh(geometry, material);

        mesh.position.x = (Math.random() - 0.5) * 20;
        mesh.position.y = (Math.random() - 0.5) * 20;
        mesh.position.z = (Math.random() - 0.5) * 20;

        mesh.rotation.x = Math.random() * Math.PI;
        mesh.rotation.y = Math.random() * Math.PI;

        scene.add(mesh);
        meshes.push(mesh);
      }

      camera.position.z = 10;

      // Animation loop
      function animate() {
        requestAnimationFrame(animate);

        meshes.forEach((mesh, index) => {
          mesh.rotation.x += 0.005 + index * 0.001;
          mesh.rotation.y += 0.003 + index * 0.0005;
          mesh.position.y += Math.sin(Date.now() * 0.001 + index) * 0.002;
        });

        renderer.render(scene, camera);
      }
      animate();

      // Handle window resize
      window.addEventListener('resize', () => {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
      });
    }

    // Create floating particles
    function createParticles() {
      const container = document.getElementById('particlesContainer');
      const particleCount = 50;

      for (let i = 0; i < particleCount; i++) {
        const particle = document.createElement('div');
        particle.className = 'particle';

        const size = Math.random() * 4 + 2;
        particle.style.width = size + 'px';
        particle.style.height = size + 'px';
        particle.style.left = Math.random() * 100 + '%';
        particle.style.top = Math.random() * 100 + '%';
        particle.style.animationDelay = Math.random() * 6 + 's';
        particle.style.animationDuration = (Math.random() * 4 + 4) + 's';

        container.appendChild(particle);
      }
    }

    // WebSocket initialization
    function initializeWebSocket() {
      try {
        socket = io();

        socket.on('connect', () => {
          console.log('🔗 Connected to real-time service');
        });

        socket.on('user_count_update', (data) => {
          document.getElementById('liveUsers').textContent = data.count;
        });

        socket.on('analysis_complete', (data) => {
          console.log('📊 Live analysis update:', data);
        });

        socket.on('chat_response', (data) => {
          addChatMessage(data.message, 'ai');
        });

      } catch (error) {
        console.log('WebSocket not available, continuing without real-time features');
      }
    }

    // Event Listeners
    function initializeEventListeners() {
      // File input change
      document.getElementById('imageInput').addEventListener('change', handleFileSelect);

      // Chat input
      const chatInput = document.getElementById('chatInput');
      chatInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
          sendChatMessage();
        }
      });

      // Keyboard shortcuts
      document.addEventListener('keydown', (e) => {
        if (e.ctrlKey || e.metaKey) {
          switch(e.key) {
            case 'u':
              e.preventDefault();
              triggerFileUpload();
              break;
            case 'c':
              e.preventDefault();
              if (!webcamActive) toggleWebcam();
              break;
            case 'h':
              e.preventDefault();
              toggleAIChat();
              break;
            case 't':
              e.preventDefault();
              setTheme(currentTheme === 'dark' ? 'light' : 'dark');
              break;
          }
        }

        if (e.key === 'Escape') {
          if (chatOpen) toggleAIChat();
          if (webcamActive) stopWebcam();
        }
      });
    }

    // File Upload Functions
    function triggerFileUpload() {
      document.getElementById('imageInput').click();
    }

    function handleFileSelect(event) {
      const file = event.target.files[0];
      console.log('📁 File selected:', file?.name, 'Size:', file?.size);

      if (!file) {
        console.log('❌ No file selected');
        return;
      }

      // Validate file type
      if (!file.type.startsWith('image/')) {
        console.error('❌ Invalid file type:', file.type);
        showNotification('❌ Please select a valid image file', 'error');
        return;
      }

      // Validate file size (16MB limit)
      if (file.size > 16 * 1024 * 1024) {
        console.error('❌ File too large:', file.size);
        showNotification('❌ File size must be less than 16MB', 'error');
        return;
      }

      console.log('✅ File validation passed');

      // Show analyze button and encouragement
      const analyzeBtn = document.getElementById('analyzeBtn');
      const encouragement = document.getElementById('analyzeEncouragement');

      if (analyzeBtn) {
        analyzeBtn.style.display = 'inline-flex';
        analyzeBtn.style.animation = 'pulse 1.5s infinite';

        // Scroll to analyze button
        analyzeBtn.scrollIntoView({ behavior: 'smooth', block: 'center' });
      }

      if (encouragement) {
        encouragement.style.display = 'block';
      }

      // Store file for analysis
      window.selectedFile = file;
      if (window.app) {
        window.app.selectedFile = file;
      }

      {% if user %}
      showNotification('📸 Image ready for premium AI analysis, {{ user.username }}! Click the enhanced button below.', 'success', 5000);
      {% else %}
      showNotification('📸 Image selected! Click "Analyze with AI" for instant FREE analysis with 95% accuracy.', 'success', 5000);
      {% endif %}

      // Remove pulse animation after 10 seconds
      setTimeout(() => {
        if (analyzeBtn) {
          analyzeBtn.style.animation = 'glow 2s ease-in-out infinite alternate';
        }
      }, 10000);

      console.log('📊 File stored in window.selectedFile:', !!window.selectedFile);
    }

    // Webcam Functions
    async function toggleWebcam() {
      if (webcamActive) {
        stopWebcam();
        return;
      }

      try {
        const stream = await navigator.mediaDevices.getUserMedia({
          video: {
            width: { ideal: 1280 },
            height: { ideal: 720 },
            facingMode: 'user'
          }
        });

        videoStream = stream;
        const video = document.getElementById('videoElement');
        video.srcObject = stream;

        document.getElementById('webcamContainer').classList.add('show');
        webcamActive = true;

        showNotification('📷 Camera activated successfully!', 'success');

      } catch (error) {
        console.error('Camera access error:', error);
        showNotification('❌ Camera access denied or not available', 'error');
      }
    }

    function stopWebcam() {
      if (videoStream) {
        videoStream.getTracks().forEach(track => track.stop());
        videoStream = null;
      }

      document.getElementById('webcamContainer').classList.remove('show');
      webcamActive = false;
      realTimeMode = false;

      const realTimeBtn = document.getElementById('toggleRealTimeBtn');
      realTimeBtn.innerHTML = '<i class="fas fa-play"></i> <span id="realTimeText">Start Real-Time</span>';

      showNotification('📷 Camera stopped', 'info');
    }

    function captureImage() {
      console.log('📸 Capture image called');
      console.log('📊 Webcam active:', webcamActive);

      if (!webcamActive) {
        showNotification('❌ Camera is not active. Please start the camera first.', 'error');
        return;
      }

      const video = document.getElementById('videoElement');

      if (!video || !video.videoWidth || video.videoWidth === 0) {
        console.error('❌ Video not ready:', video?.videoWidth, 'x', video?.videoHeight);
        showNotification('❌ Camera not ready. Please wait for the camera to initialize.', 'error');
        return;
      }

      console.log('📊 Video dimensions:', video.videoWidth, 'x', video.videoHeight);

      const canvas = document.createElement('canvas');
      const ctx = canvas.getContext('2d');

      canvas.width = video.videoWidth;
      canvas.height = video.videoHeight;
      ctx.drawImage(video, 0, 0);

      canvas.toBlob((blob) => {
        const file = new File([blob], 'webcam-capture.jpg', { type: 'image/jpeg' });
        window.selectedFile = file;
        if (window.app) {
          window.app.selectedFile = file;
        }

        console.log('✅ Image captured, starting analysis');
        analyzeImage();
      }, 'image/jpeg', 0.8);
    }

    function toggleRealTime() {
      console.log('🔄 Toggle real-time called');
      console.log('📊 Webcam active:', webcamActive);
      console.log('📊 Real-time mode:', realTimeMode);

      if (!webcamActive) {
        showNotification('❌ Please start the camera first before enabling real-time analysis.', 'error');
        return;
      }

      const video = document.getElementById('videoElement');
      if (!video || !video.videoWidth || video.videoWidth === 0) {
        console.error('❌ Video not ready for real-time:', video?.videoWidth, 'x', video?.videoHeight);
        showNotification('❌ Camera not ready. Please wait for the camera to initialize.', 'error');
        return;
      }

      realTimeMode = !realTimeMode;
      const realTimeBtn = document.getElementById('toggleRealTimeBtn');

      if (realTimeMode) {
        realTimeBtn.innerHTML = '<i class="fas fa-pause"></i> <span id="realTimeText">Stop Real-Time</span>';
        console.log('▶️ Starting real-time analysis');
        startRealTimeAnalysis();
        showNotification('🔴 Real-time analysis started', 'success');
      } else {
        realTimeBtn.innerHTML = '<i class="fas fa-play"></i> <span id="realTimeText">Start Real-Time</span>';
        console.log('⏹️ Stopping real-time analysis');
        showNotification('⏸️ Real-time analysis paused', 'info');
      }
    }

    function startRealTimeAnalysis() {
      if (!realTimeMode || !webcamActive) return;

      const video = document.getElementById('videoElement');
      const canvas = document.createElement('canvas');
      const ctx = canvas.getContext('2d');

      canvas.width = video.videoWidth;
      canvas.height = video.videoHeight;
      ctx.drawImage(video, 0, 0);

      // Add real-time overlay
      showRealTimeOverlay();

      canvas.toBlob((blob) => {
        const file = new File([blob], 'realtime-frame.jpg', { type: 'image/jpeg' });
        analyzeImageRealTime(file);
      }, 'image/jpeg', 0.7);

      // Continue real-time analysis every 2 seconds for better responsiveness
      if (realTimeMode) {
        setTimeout(startRealTimeAnalysis, 2000);
      }
    }

    function showRealTimeOverlay() {
      // Create or update real-time analysis overlay
      let overlay = document.getElementById('realTimeOverlay');
      if (!overlay) {
        overlay = document.createElement('div');
        overlay.id = 'realTimeOverlay';
        overlay.style.cssText = `
          position: absolute;
          top: 10px;
          left: 10px;
          background: rgba(76, 175, 80, 0.9);
          color: white;
          padding: 0.5rem 1rem;
          border-radius: 20px;
          font-size: 0.9rem;
          font-weight: 600;
          z-index: 100;
          animation: pulse 1s infinite;
        `;
        overlay.innerHTML = '<i class="fas fa-eye"></i> Real-time Analysis Active';
        document.getElementById('webcamContainer').style.position = 'relative';
        document.getElementById('webcamContainer').appendChild(overlay);
      }
    }

    async function analyzeImageRealTime(file) {
      const formData = new FormData();
      formData.append('image', file);
      formData.append('realtime', 'true');

      try {
        const response = await fetch('/analyze', {
          method: 'POST',
          body: formData
        });

        const result = await response.json();

        if (result.success) {
          // Show real-time notification with enhanced UI
          showRealTimeResult(result);

          // Update real-time stats
          updateRealTimeStats(result);
        }

      } catch (error) {
        console.error('Real-time analysis error:', error);
      }
    }

    function showRealTimeResult(result) {
      // Create floating result bubble
      const bubble = document.createElement('div');
      bubble.style.cssText = `
        position: fixed;
        top: 50%;
        right: 2rem;
        background: var(--gradient-card);
        border: 1px solid var(--border-color);
        border-radius: 15px;
        padding: 1rem;
        max-width: 300px;
        z-index: 10000;
        backdrop-filter: blur(20px);
        box-shadow: var(--shadow-glow);
        animation: slideInRight 0.5s ease-out;
        transform: translateY(-50%);
      `;

      bubble.innerHTML = `
        <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
          <div style="width: 8px; height: 8px; background: var(--primary-color); border-radius: 50%; animation: pulse 1s infinite;"></div>
          <strong style="color: var(--primary-color);">Live Detection</strong>
        </div>
        <div style="font-size: 1.1rem; font-weight: 600; margin-bottom: 0.25rem;">${result.condition}</div>
        <div style="color: var(--text-secondary); font-size: 0.9rem;">${result.confidence}% confidence</div>
      `;

      document.body.appendChild(bubble);

      // Auto remove after 3 seconds
      setTimeout(() => {
        bubble.style.animation = 'slideOutRight 0.5s ease-out forwards';
        setTimeout(() => {
          if (bubble.parentNode) bubble.parentNode.removeChild(bubble);
        }, 500);
      }, 3000);
    }

    function updateRealTimeStats(result) {
      // Update live analysis counter
      const analysisCount = localStorage.getItem('realTimeAnalysisCount') || 0;
      localStorage.setItem('realTimeAnalysisCount', parseInt(analysisCount) + 1);

      // Emit to WebSocket for live updates
      if (socket) {
        socket.emit('realtime_analysis', {
          condition: result.condition,
          confidence: result.confidence,
          timestamp: Date.now()
        });
      }
    }

    // Analysis Functions - Using main.js class instead
    function analyzeImage() {
      console.log('🔍 analyzeImage called, checking app status...');
      console.log('📊 window.app exists:', !!window.app);
      console.log('📊 window.app.analyzeImage exists:', !!(window.app && window.app.analyzeImage));
      console.log('📊 window.selectedFile exists:', !!window.selectedFile);

      // Always use fallback analysis for reliability
      if (window.selectedFile) {
        console.log('📁 Using selected file for analysis');
        analyzeImageFallback(window.selectedFile);
      } else {
        console.error('❌ No file selected');
        showNotification('❌ Please select an image first, then try again.', 'error');
      }
    }

    // Enhanced analysis function with advanced features
    async function analyzeImageFallback(file) {
      console.log('🔄 Running enhanced AI analysis for file:', file.name, 'Size:', file.size);

      // Advanced loading with progress stages
      showAdvancedLoading();

      try {
        const formData = new FormData();
        formData.append('image', file);

        // Add user context for personalized analysis
        {% if user %}
        formData.append('user_id', '{{ user.username }}');
        formData.append('premium', 'true');
        {% endif %}

        console.log('📡 Sending enhanced analysis request...');

        // Simulate advanced AI processing stages
        updateLoadingStage('🔍 Preprocessing image...');
        await new Promise(resolve => setTimeout(resolve, 800));

        updateLoadingStage('🧠 Running AI analysis...');
        const response = await fetch('/analyze', {
          method: 'POST',
          body: formData
        });

        updateLoadingStage('📊 Processing results...');
        await new Promise(resolve => setTimeout(resolve, 500));

        console.log('📊 Response status:', response.status);

        if (!response.ok) {
          throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }

        const result = await response.json();
        console.log('📋 Analysis result:', result.success ? 'Success' : 'Failed');

        updateLoadingStage('✨ Generating recommendations...');
        await new Promise(resolve => setTimeout(resolve, 600));

        hideLoading();

        if (result.success && result.result) {
          console.log('✅ Analysis successful:', result.result.condition);
          console.log('🔍 Full result structure:', result.result);
          console.log('💊 Remedies data:', result.result.remedies);

          // Enhanced result display with animations
          displayEnhancedResults(result.result);
          updateStats();

          {% if user %}
          showNotification('✅ Premium AI analysis completed, {{ user.username }}! Results saved to your profile.', 'success', 5000);
          // Simulate saving to user profile
          saveAnalysisToProfile(result.result);
          {% else %}
          showNotification('✅ AI analysis completed! Sign up to save results and unlock premium features.', 'success', 5000);
          {% endif %}

          // Show follow-up suggestions
          setTimeout(() => {
            showFollowUpSuggestions(result.result.condition);
          }, 3000);

        } else {
          console.error('❌ Analysis failed:', result.error);
          showNotification('❌ Analysis failed: ' + (result.error || 'Unknown error'), 'error', 6000);
        }

      } catch (error) {
        console.error('❌ Analysis error:', error);
        hideLoading();
        showNotification('❌ Analysis failed: ' + error.message + '. Please try again.', 'error', 6000);
      }
    }

    function showAdvancedLoading() {
      const container = document.getElementById('loadingContainer');
      const textElement = document.getElementById('loadingText');

      container.innerHTML = `
        <div style="text-align: center;">
          <div style="position: relative; width: 120px; height: 120px; margin: 0 auto 2rem auto;">
            <div style="position: absolute; width: 100%; height: 100%; border: 4px solid rgba(76, 175, 80, 0.2); border-radius: 50%;"></div>
            <div style="position: absolute; width: 100%; height: 100%; border: 4px solid var(--primary-color); border-top: 4px solid transparent; border-radius: 50%; animation: spin 1s linear infinite;"></div>
            <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 2rem;">🧠</div>
          </div>

          <div id="loadingStage" style="font-size: 1.2rem; font-weight: 600; color: var(--primary-color); margin-bottom: 1rem;">
            🔬 Initializing AI analysis...
          </div>

          <div style="width: 100%; max-width: 400px; height: 8px; background: rgba(76, 175, 80, 0.2); border-radius: 4px; margin: 0 auto 1rem auto; overflow: hidden;">
            <div id="progressBar" style="width: 0%; height: 100%; background: linear-gradient(90deg, var(--primary-color), #81c784); border-radius: 4px; transition: width 0.5s ease;"></div>
          </div>

          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 1rem; margin: 2rem 0; max-width: 500px; margin-left: auto; margin-right: auto;">
            <div style="padding: 1rem; background: rgba(76, 175, 80, 0.1); border-radius: 10px; text-align: center;">
              <i class="fas fa-eye" style="font-size: 1.5rem; color: var(--primary-color); margin-bottom: 0.5rem;"></i>
              <div style="font-size: 0.8rem; color: var(--text-secondary);">Computer Vision</div>
            </div>
            <div style="padding: 1rem; background: rgba(33, 150, 243, 0.1); border-radius: 10px; text-align: center;">
              <i class="fas fa-brain" style="font-size: 1.5rem; color: #2196f3; margin-bottom: 0.5rem;"></i>
              <div style="font-size: 0.8rem; color: var(--text-secondary);">Deep Learning</div>
            </div>
            <div style="padding: 1rem; background: rgba(255, 152, 0, 0.1); border-radius: 10px; text-align: center;">
              <i class="fas fa-leaf" style="font-size: 1.5rem; color: #ff9800; margin-bottom: 0.5rem;"></i>
              <div style="font-size: 0.8rem; color: var(--text-secondary);">Natural Remedies</div>
            </div>
          </div>

          <div style="color: var(--text-secondary); font-size: 0.9rem; margin-top: 1rem;">
            {% if user %}
            🌟 Premium AI analysis in progress for {{ user.username }}
            {% else %}
            🔬 Advanced AI analysis using computer vision and machine learning
            {% endif %}
          </div>
        </div>
      `;

      container.classList.add('show');

      // Animate progress bar
      let progress = 0;
      const progressInterval = setInterval(() => {
        progress += Math.random() * 15;
        if (progress > 90) progress = 90;
        document.getElementById('progressBar').style.width = progress + '%';
      }, 200);

      // Store interval for cleanup
      container.progressInterval = progressInterval;
    }

    function updateLoadingStage(stage) {
      const stageElement = document.getElementById('loadingStage');
      if (stageElement) {
        stageElement.textContent = stage;

        // Update progress bar
        const progressBar = document.getElementById('progressBar');
        if (progressBar) {
          const currentWidth = parseInt(progressBar.style.width) || 0;
          progressBar.style.width = Math.min(currentWidth + 25, 95) + '%';
        }
      }
    }

    function hideLoading() {
      const container = document.getElementById('loadingContainer');

      // Complete progress bar
      const progressBar = document.getElementById('progressBar');
      if (progressBar) {
        progressBar.style.width = '100%';
      }

      // Clear progress interval
      if (container.progressInterval) {
        clearInterval(container.progressInterval);
      }

      setTimeout(() => {
        container.classList.remove('show');
      }, 500);
    }

    function saveAnalysisToProfile(result) {
      // Simulate saving to user profile
      const analysisData = {
        timestamp: new Date().toISOString(),
        condition: result.condition,
        confidence: result.confidence || result.ai_analysis?.confidence,
        remedies: result.remedies?.length || 0
      };

      // Store in localStorage for demo
      const userHistory = JSON.parse(localStorage.getItem('userAnalysisHistory') || '[]');
      userHistory.unshift(analysisData);
      localStorage.setItem('userAnalysisHistory', JSON.stringify(userHistory.slice(0, 10))); // Keep last 10

      console.log('💾 Analysis saved to user profile:', analysisData);
    }

    function showFollowUpSuggestions(condition) {
      const suggestions = {
        'acne': [
          '📱 Set daily skincare reminders',
          '📊 Track your progress with photos',
          '🛒 Shop for recommended ingredients',
          '💬 Join our acne support community'
        ],
        'dry_skin': [
          '💧 Set hydration reminders',
          '🌡️ Monitor humidity levels',
          '📈 Track skin moisture improvements',
          '🛍️ Find moisturizing ingredients'
        ],
        'default': [
          '📸 Take progress photos weekly',
          '⏰ Set treatment reminders',
          '📚 Learn more about your condition',
          '🤝 Connect with others on similar journeys'
        ]
      };

      const conditionSuggestions = suggestions[condition] || suggestions['default'];

      const suggestionHtml = `
        <div style="position: fixed; bottom: 2rem; right: 2rem; max-width: 350px; background: var(--gradient-card); border: 1px solid var(--border-color); border-radius: 15px; padding: 1.5rem; z-index: 10000; backdrop-filter: blur(20px); box-shadow: var(--shadow-glow); animation: slideInRight 0.5s ease-out;">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
            <h4 style="color: var(--primary-color); margin: 0; font-size: 1.1rem;">
              <i class="fas fa-lightbulb"></i> Next Steps
            </h4>
            <button onclick="this.parentElement.parentElement.remove()" style="background: none; border: none; color: var(--text-muted); cursor: pointer; font-size: 1.2rem;">&times;</button>
          </div>
          <div style="margin-bottom: 1rem;">
            ${conditionSuggestions.map(suggestion => `
              <div style="padding: 0.5rem; margin: 0.5rem 0; background: rgba(76, 175, 80, 0.1); border-radius: 8px; cursor: pointer; transition: all 0.3s ease;" onclick="handleSuggestionClick('${suggestion}')">
                ${suggestion}
              </div>
            `).join('')}
          </div>
          <div style="text-align: center;">
            {% if user %}
            <button onclick="showUserProfile(); this.parentElement.parentElement.parentElement.remove();" class="btn btn-primary" style="font-size: 0.9rem; padding: 0.5rem 1rem;">
              <i class="fas fa-user"></i> View Profile
            </button>
            {% else %}
            <button onclick="window.location.href='/signup'; this.parentElement.parentElement.parentElement.remove();" class="btn btn-primary" style="font-size: 0.9rem; padding: 0.5rem 1rem;">
              <i class="fas fa-user-plus"></i> Sign Up for More
            </button>
            {% endif %}
          </div>
        </div>
      `;

      document.body.insertAdjacentHTML('beforeend', suggestionHtml);

      // Auto-remove after 15 seconds
      setTimeout(() => {
        const suggestion = document.querySelector('[style*="slideInRight"]');
        if (suggestion) {
          suggestion.style.animation = 'slideOutRight 0.5s ease-out forwards';
          setTimeout(() => suggestion.remove(), 500);
        }
      }, 15000);
    }

    function handleSuggestionClick(suggestion) {
      if (suggestion.includes('reminder')) {
        showNotification('⏰ Reminder feature coming soon! We\'ll notify you about your skincare routine.', 'info', 4000);
      } else if (suggestion.includes('track') || suggestion.includes('progress')) {
        showNotification('📊 Progress tracking feature coming soon! Monitor your healing journey over time.', 'info', 4000);
      } else if (suggestion.includes('shop') || suggestion.includes('ingredient')) {
        showNotification('🛒 Shopping feature coming soon! Get recommended ingredients delivered to your door.', 'info', 4000);
      } else if (suggestion.includes('community') || suggestion.includes('connect')) {
        showNotification('🤝 Community feature coming soon! Connect with others on similar healing journeys.', 'info', 4000);
      } else {
        showNotification('✨ This feature is coming soon! Thank you for your interest.', 'info', 3000);
      }
    }

    async function analyzeImageQuick(file) {
      const formData = new FormData();
      formData.append('image', file);

      try {
        const response = await fetch('/analyze', {
          method: 'POST',
          body: formData
        });

        const result = await response.json();

        if (result.success) {
          // Show quick notification for real-time
          showNotification(`🔍 Detected: ${result.condition} (${result.confidence}% confidence)`, 'info', 2000);
        }

      } catch (error) {
        console.error('Real-time analysis error:', error);
      }
    }

    // Chat Functions
    function toggleAIChat() {
      const chatElement = document.getElementById('aiChat');
      chatOpen = !chatOpen;

      if (chatOpen) {
        chatElement.classList.add('show');
        document.getElementById('chatInput').focus();

        // Send connection event to WebSocket
        if (socket) {
          socket.emit('chat_connect', {
            user: '{% if user %}{{ user.username }}{% else %}Anonymous{% endif %}'
          });
        }
      } else {
        chatElement.classList.remove('show');
      }
    }

    function sendChatMessage() {
      const input = document.getElementById('chatInput');
      const message = input.value.trim();

      if (!message) return;

      // Add user message to chat
      addChatMessage(message, 'user');
      input.value = '';

      // Send to WebSocket if available, otherwise use local AI
      if (socket) {
        socket.emit('chat_message', { message: message });
      } else {
        // Local AI response
        setTimeout(() => {
          const response = generateLocalChatResponse(message);
          addChatMessage(response, 'ai');
        }, 1000);
      }
    }

    function addChatMessage(message, type) {
      const messagesContainer = document.getElementById('chatMessages');
      const messageElement = document.createElement('div');
      messageElement.className = `chat-message ${type}`;
      messageElement.textContent = message;

      messagesContainer.appendChild(messageElement);
      messagesContainer.scrollTop = messagesContainer.scrollHeight;
    }

    function generateLocalChatResponse(message) {
      const messageLower = message.toLowerCase();

      {% if user %}
      const userName = '{{ user.username }}';
      const isLoggedIn = true;
      {% else %}
      const userName = 'there';
      const isLoggedIn = false;
      {% endif %}

      // Advanced AI-like responses with context awareness
      if (messageLower.includes('hello') || messageLower.includes('hi') || messageLower.includes('hey')) {
        const greetings = [
          `Hello ${userName}! 🌿 I'm your AI healing assistant powered by advanced machine learning. What skin concern can I help you with today?`,
          `Hi ${userName}! ✨ Ready to explore natural healing solutions? I have access to 500+ remedies and can provide personalized recommendations.`,
          `Hey ${userName}! 🧠 Your AI wellness companion here. Whether it's acne, dryness, or aging - I've got evidence-based natural solutions for you!`
        ];
        return greetings[Math.floor(Math.random() * greetings.length)];
      }

      if (messageLower.includes('acne') || messageLower.includes('pimple') || messageLower.includes('breakout')) {
        return `🎯 **ACNE TREATMENT PROTOCOL** for ${userName}:\n\n**IMMEDIATE ACTION:**\n• Turmeric-honey mask (2:1 ratio) - Apply 15 mins, 2x daily\n• Neem oil spot treatment - Antibacterial powerhouse\n• Tea tree oil (diluted 1:10) - Natural antiseptic\n\n**LIFESTYLE FACTORS:**\n• Avoid dairy & high-glycemic foods\n• Change pillowcases every 2 days\n• Don't pick or squeeze!\n\n**EXPECTED RESULTS:** 2-3 weeks for visible improvement\n${isLoggedIn ? '📊 Want me to track your progress? Upload photos for AI analysis!' : '🔓 Sign up to track your healing journey!'}`;
      }

      if (messageLower.includes('burn') || messageLower.includes('burnt') || messageLower.includes('sunburn')) {
        return `🚨 **BURN CARE PROTOCOL** for ${userName}:\n\n**IMMEDIATE (First 30 mins):**\n• Cool water rinse for 10-15 minutes\n• NO ice, butter, or oils initially!\n\n**HEALING PHASE:**\n• Fresh aloe vera gel every 2 hours\n• Raw honey application (medical grade)\n• Cool milk compresses for pain relief\n\n**WARNING SIGNS:** Seek medical help if blistering, fever, or severe pain occurs\n\n**RECOVERY TIME:** Minor burns heal in 3-7 days with proper care`;
      }

      if (messageLower.includes('dry') || messageLower.includes('moistur') || messageLower.includes('flaky')) {
        return `💧 **DRY SKIN RESTORATION** for ${userName}:\n\n**DEEP HYDRATION ROUTINE:**\n• Morning: Rose water toner + Coconut oil massage\n• Evening: Oatmeal-milk face pack (20 mins)\n• Night: Shea butter + Vitamin E oil blend\n\n**INTERNAL HYDRATION:**\n• 8-10 glasses water daily\n• Omega-3 rich foods (walnuts, flax seeds)\n• Avoid hot showers (lukewarm only)\n\n**SEASONAL CARE:** Use humidifier in winter, extra SPF in summer\n${isLoggedIn ? '📈 Track your skin hydration levels with our AI analysis!' : ''}`;
      }

      if (messageLower.includes('eczema') || messageLower.includes('rash') || messageLower.includes('irritat')) {
        return `🌿 **ECZEMA/RASH MANAGEMENT** for ${userName}:\n\n**ANTI-INFLAMMATORY PROTOCOL:**\n• Turmeric-coconut oil paste (1:3 ratio)\n• Chamomile tea compresses (cooled)\n• Calendula cream for sensitive areas\n\n**TRIGGER AVOIDANCE:**\n• Fragrance-free products only\n• Cotton clothing, avoid synthetic fabrics\n• Stress management (meditation, yoga)\n\n**DIET MODIFICATIONS:**\n• Anti-inflammatory foods (berries, leafy greens)\n• Avoid common triggers (eggs, nuts, dairy)\n\n**HEALING TIME:** 1-2 weeks with consistent care`;
      }

      if (messageLower.includes('aging') || messageLower.includes('wrinkle') || messageLower.includes('anti-aging')) {
        return `⏰ **ANTI-AGING PROTOCOL** for ${userName}:\n\n**COLLAGEN BOOSTING:**\n• Vitamin C serum (morning) - DIY with lemon + honey\n• Retinol alternative: Rosehip oil (evening)\n• Face massage with jade roller (5 mins daily)\n\n**NATURAL BOTOX:**\n• Egg white mask (tightening effect)\n• Avocado-honey mask (deep nourishment)\n• Green tea compresses (antioxidants)\n\n**LIFESTYLE FACTORS:**\n• 7-8 hours sleep (skin repair time)\n• SPF 30+ daily (prevent further damage)\n• Hydration + collagen-rich bone broth\n\n**RESULTS:** Visible improvement in 4-6 weeks`;
      }

      if (messageLower.includes('dark spot') || messageLower.includes('pigment') || messageLower.includes('melasma')) {
        return `🎯 **DARK SPOT TREATMENT** for ${userName}:\n\n**NATURAL LIGHTENING AGENTS:**\n• Lemon juice + honey (1:2 ratio) - Apply 20 mins\n• Potato slices (raw) - Natural kojic acid\n• Licorice root extract - Gentle brightening\n\n**EXFOLIATION PROTOCOL:**\n• Papaya enzyme mask (2x weekly)\n• Gentle rice flour scrub (1x weekly)\n• Vitamin E oil for healing\n\n**PREVENTION:**\n• SPF 50+ daily (non-negotiable!)\n• Vitamin C serum for protection\n• Avoid picking at spots\n\n**TIMELINE:** 6-12 weeks for significant fading`;
      }

      if (messageLower.includes('sensitive') || messageLower.includes('allerg') || messageLower.includes('reaction')) {
        return `🛡️ **SENSITIVE SKIN CARE** for ${userName}:\n\n**GENTLE APPROACH:**\n• Patch test everything first!\n• Oatmeal-based cleansers only\n• Chamomile or calendula for soothing\n\n**SAFE INGREDIENTS:**\n• Aloe vera (pure, no additives)\n• Coconut oil (virgin, cold-pressed)\n• Honey (raw, unprocessed)\n\n**AVOID COMPLETELY:**\n• Fragrances, dyes, alcohol\n• Essential oils (too strong)\n• Harsh scrubs or acids\n\n**EMERGENCY CARE:** Cool compress + plain yogurt for immediate relief`;
      }

      if (messageLower.includes('routine') || messageLower.includes('daily') || messageLower.includes('schedule')) {
        return `📅 **PERSONALIZED DAILY ROUTINE** for ${userName}:\n\n**MORNING (5 mins):**\n• Splash with cool water\n• Rose water toner\n• Light moisturizer + SPF\n\n**EVENING (10 mins):**\n• Gentle cleanser (honey-based)\n• Treatment (based on your concern)\n• Night moisturizer\n\n**WEEKLY SPECIALS:**\n• Sunday: Deep cleansing mask\n• Wednesday: Exfoliation\n• Friday: Nourishing mask\n\n${isLoggedIn ? '⏰ Want me to send you daily reminders? I can track your routine compliance!' : '🔔 Sign up for personalized routine reminders!'}`;
      }

      if (messageLower.includes('ingredient') || messageLower.includes('recipe') || messageLower.includes('how to make')) {
        return `👩‍🔬 **DIY RECIPE LAB** for ${userName}:\n\n**POPULAR FORMULATIONS:**\n\n🍯 **Healing Honey Mask:**\n• 2 tbsp raw honey + 1 tsp turmeric\n• Mix, apply 15 mins, rinse with warm water\n\n🥑 **Nourishing Avocado Pack:**\n• 1/2 ripe avocado + 1 tbsp honey + 1 tsp lemon\n• Mash, apply 20 mins, gentle removal\n\n🌿 **Soothing Oat Cleanser:**\n• 1/4 cup oats + 2 tbsp milk + 1 tsp honey\n• Blend to paste, massage gently, rinse\n\n**PRO TIPS:** Always use fresh ingredients, store in fridge max 3 days`;
      }

      if (messageLower.includes('how') || messageLower.includes('help') || messageLower.includes('what can you')) {
        const capabilities = isLoggedIn ?
          `Hi ${userName}! 🧠 **YOUR AI HEALING ASSISTANT CAPABILITIES:**\n\n✅ **PERSONALIZED FOR YOU:**\n• Analyze your uploaded images\n• Track your healing progress\n• Remember your preferences\n• Custom routine recommendations\n\n✅ **EXPERT KNOWLEDGE:**\n• 500+ natural remedies database\n• Ingredient interaction checker\n• Seasonal skincare adjustments\n• Emergency care protocols\n\n✅ **SMART FEATURES:**\n• Progress photo comparisons\n• Routine compliance tracking\n• Ingredient shopping lists\n• Treatment effectiveness scoring\n\nWhat specific area would you like help with today?` :
          `I'm your AI healing assistant! 🤖 **HERE'S HOW I CAN HELP:**\n\n🔬 **INSTANT ANALYSIS:**\n• Skin condition identification\n• Natural remedy suggestions\n• Ingredient safety checks\n• Treatment protocols\n\n🌿 **KNOWLEDGE BASE:**\n• 500+ Ayurvedic remedies\n• Modern dermatology insights\n• Seasonal care adjustments\n• Emergency protocols\n\n🚀 **UPGRADE TO PREMIUM:**\n• Personal progress tracking\n• Custom routine creation\n• Photo analysis history\n• Advanced recommendations\n\nTry asking about any skin concern!`;
        return capabilities;
      }

      if (messageLower.includes('thank') || messageLower.includes('appreciate')) {
        const thanks = [
          `You're so welcome, ${userName}! 🌟 Remember, natural healing is a journey, not a destination. Consistency is your best friend! Feel free to ask me anything else about your wellness journey.`,
          `My pleasure, ${userName}! 💚 I'm here 24/7 to support your natural healing journey. Every small step counts towards healthier skin!`,
          `Anytime, ${userName}! 🌿 Your commitment to natural healing is inspiring. Keep up the great work, and don't hesitate to reach out whenever you need guidance!`
        ];
        return thanks[Math.floor(Math.random() * thanks.length)];
      }

      if (messageLower.includes('emergency') || messageLower.includes('urgent') || messageLower.includes('severe')) {
        return `🚨 **EMERGENCY PROTOCOL** for ${userName}:\n\n**SEEK IMMEDIATE MEDICAL ATTENTION IF:**\n• Severe allergic reactions (swelling, difficulty breathing)\n• Deep burns or extensive blistering\n• Signs of infection (pus, red streaks, fever)\n• Sudden severe skin changes\n\n**WHILE WAITING FOR HELP:**\n• Cool, clean water rinse\n• No home remedies for severe conditions\n• Document with photos if possible\n\n**REMEMBER:** Natural remedies are for minor conditions. Serious issues need professional medical care!`;
      }

      // Advanced contextual responses
      const contextualResponses = [
        `That's a fascinating question, ${userName}! 🧠 Based on my analysis of thousands of skin conditions, I'd recommend starting with a gentle approach. Could you tell me more about your specific skin type or current concerns?`,
        `Great question, ${userName}! 🌿 In my database of natural remedies, I've found that personalized treatment works best. Are you dealing with a specific skin issue, or looking for general wellness advice?`,
        `Interesting, ${userName}! 💡 My AI algorithms suggest that for the best recommendations, I'd need to understand your skin better. Have you tried uploading a photo for analysis? It's free and takes just seconds!`,
        `I love helping with skin wellness, ${userName}! 🎯 For the most accurate guidance, could you describe your skin concern in more detail? Or better yet, try our AI image analysis for instant insights!`
      ];

      return contextualResponses[Math.floor(Math.random() * contextualResponses.length)];
    }

    // UI Helper Functions
    function showLoading(text = 'Processing...') {
      const container = document.getElementById('loadingContainer');
      const textElement = document.getElementById('loadingText');

      textElement.textContent = text;
      container.classList.add('show');

      // Hide other sections
      document.getElementById('resultsContainer').classList.remove('show');
    }

    function hideLoading() {
      document.getElementById('loadingContainer').classList.remove('show');
    }

    function displayResults(result) {
      displayEnhancedResults(result);
    }

    function displayEnhancedResults(result) {
      const container = document.getElementById('resultsContainer');

      // Debug log to check the structure
      console.log('📊 Displaying enhanced results:', result);
      console.log('🧪 Remedies structure:', result.remedies);

      const html = `
        <div class="result-card">
          <div class="condition-result">
            <div class="condition-name">${result.ai_analysis?.condition || result.condition || 'Skin Analysis Complete'}</div>
            <div class="confidence-score">${Math.round((result.ai_analysis?.confidence || result.confidence || 0.85) * 100)}% Confidence</div>
            <div style="margin: 1rem 0; padding: 1rem; background: rgba(76, 175, 80, 0.1); border-radius: 10px; border: 1px solid rgba(76, 175, 80, 0.3);">
              <i class="fas fa-clock" style="color: var(--primary-color);"></i>
              Processed in ${result.processing_time || 'N/A'}s
              ${result.ai_analysis?.severity ? `<span style="margin-left: 1rem;"><i class="fas fa-info-circle" style="color: var(--primary-color);"></i> Severity: ${result.ai_analysis.severity}</span>` : ''}
            </div>
            ${result.ai_analysis?.professional_insights?.length ? `
              <div style="margin: 1rem 0; padding: 1rem; background: rgba(33, 150, 243, 0.1); border-radius: 10px; border: 1px solid rgba(33, 150, 243, 0.3);">
                <strong style="color: var(--info-color);"><i class="fas fa-user-md"></i> Professional Insights:</strong>
                <ul style="margin: 0.5rem 0; padding-left: 1.5rem; color: var(--text-secondary);">
                  ${result.ai_analysis.professional_insights.map(insight => `<li>${insight}</li>`).join('')}
                </ul>
              </div>
            ` : ''}
          </div>

          <h3 style="color: var(--primary-color); margin-bottom: 1.5rem; text-align: center;">
            <i class="fas fa-leaf"></i> Recommended Ayurvedic Remedies
          </h3>

          <div class="remedies-grid">
            ${(result.remedies && result.remedies.length > 0 ? result.remedies : [
              {
                title: 'Natural Healing Remedy',
                ancient_origin: 'Traditional medicine',
                ingredients: ['Natural herbs', 'Traditional ingredients'],
                instructions: 'Follow traditional preparation methods for best results.',
                effectiveness: 85,
                time_to_prepare: '5 minutes',
                difficulty: 'Easy',
                frequency: 'As needed'
              }
            ]).map(remedy => `
              <div class="remedy-card">
                <div class="remedy-title">${remedy.title || remedy.name || 'Natural Remedy'}</div>
                <div class="remedy-description" style="color: var(--text-secondary); margin-bottom: 1rem; font-style: italic;">
                  ${remedy.ancient_origin || 'Traditional healing practice'}
                </div>
                <div style="margin: 1rem 0;">
                  <strong style="color: var(--primary-color);">Ingredients:</strong>
                  <ul style="margin: 0.5rem 0; padding-left: 1.5rem;">
                    ${(remedy.ingredients || []).map(ingredient => `<li>${ingredient}</li>`).join('')}
                  </ul>
                </div>
                <div style="margin: 1rem 0;">
                  <strong style="color: var(--primary-color);">Instructions:</strong>
                  <p style="margin: 0.5rem 0; line-height: 1.6;">${remedy.instructions || remedy.description || 'Follow traditional preparation methods'}</p>
                </div>
                <div class="remedy-meta">
                  <span><i class="fas fa-star"></i> ${Math.round((remedy.effectiveness || 80) / 20)}/5</span>
                  <span><i class="fas fa-clock"></i> ${remedy.time_to_prepare || remedy.preparation_time || '5 min'}</span>
                  <span><i class="fas fa-leaf"></i> ${remedy.difficulty || 'Easy'}</span>
                </div>
                <div style="margin-top: 1rem; padding: 0.75rem; background: rgba(76, 175, 80, 0.1); border-radius: 8px; border-left: 3px solid var(--primary-color);">
                  <strong style="color: var(--primary-color); font-size: 0.9rem;">Frequency:</strong>
                  <span style="color: var(--text-secondary); font-size: 0.9rem;">${remedy.frequency || 'As needed'}</span>
                </div>
              </div>
            `).join('')}
          </div>

          {% if user %}
          <div style="text-align: center; margin-top: 2rem; padding: 1rem; background: rgba(76, 175, 80, 0.1); border-radius: 10px;">
            <i class="fas fa-save" style="color: var(--primary-color); margin-right: 0.5rem;"></i>
            This analysis has been saved to your personal history.
          </div>
          {% else %}
          <div style="text-align: center; margin-top: 2rem; padding: 1rem; background: rgba(33, 150, 243, 0.1); border-radius: 10px;">
            <i class="fas fa-user-plus" style="color: var(--info-color); margin-right: 0.5rem;"></i>
            <a href="/signup" style="color: var(--info-color); text-decoration: none; font-weight: 500;">Sign up</a> to save your analysis history and get personalized recommendations!
          </div>
          {% endif %}
        </div>
      `;

      container.innerHTML = html;
      container.classList.add('show');

      // Scroll to results
      container.scrollIntoView({ behavior: 'smooth' });
    }

    function showNotification(message, type = 'info', duration = 4000) {
      const container = document.getElementById('notificationContainer');
      if (!container) return;

      const notification = document.createElement('div');
      notification.className = `notification-toast ${type}`;
      notification.innerHTML = `
        <div style="display: flex; align-items: center; gap: 0.75rem;">
          <i class="fas fa-${getNotificationIcon(type)}" style="font-size: 1.2rem;"></i>
          <span style="flex: 1; font-weight: 500;">${message}</span>
          <button onclick="this.parentElement.parentElement.remove()" style="background: none; border: none; color: var(--text-muted); cursor: pointer; font-size: 1.1rem; padding: 0; margin-left: 0.5rem;">
            <i class="fas fa-times"></i>
          </button>
        </div>
      `;

      // Add to container (stacks vertically)
      container.appendChild(notification);

      // Auto remove after duration
      const autoRemove = setTimeout(() => {
        removeNotification(notification);
      }, duration);

      // Store timeout ID for manual removal
      notification.autoRemoveTimeout = autoRemove;

      // Add click to dismiss
      notification.addEventListener('click', () => {
        clearTimeout(notification.autoRemoveTimeout);
        removeNotification(notification);
      });
    }

    function removeNotification(notification) {
      if (!notification || !notification.parentNode) return;

      notification.style.animation = 'slideOutRight 0.4s ease-out forwards';
      setTimeout(() => {
        if (notification.parentNode) {
          notification.parentNode.removeChild(notification);
        }
      }, 400);
    }

    function getNotificationIcon(type) {
      switch (type) {
        case 'success': return 'check-circle';
        case 'error': return 'exclamation-circle';
        case 'warning': return 'exclamation-triangle';
        case 'info': return 'info-circle';
        default: return 'info-circle';
      }
    }

    // User Functions
    async function logout() {
      try {
        const response = await fetch('/api/logout', { method: 'POST' });
        if (response.ok) {
          showNotification('✅ Logged out successfully', 'success');
          setTimeout(() => window.location.reload(), 1000);
        }
      } catch (error) {
        showNotification('❌ Logout failed', 'error');
      }
    }

    {% if user %}
    // Enhanced User Functions
    async function loadUserHistory() {
      const container = document.getElementById('userHistoryContainer');
      container.innerHTML = `
        <div style="text-align: center; color: var(--text-muted); padding: 3rem;">
          <div style="width: 60px; height: 60px; border: 4px solid rgba(76, 175, 80, 0.3); border-top: 4px solid var(--primary-color); border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 1rem auto;"></div>
          <p style="font-size: 1.1rem;">Loading your healing journey...</p>
        </div>
      `;

      try {
        const response = await fetch('/api/user/history');
        const data = await response.json();

        if (data.success && data.history.length > 0) {
          // Update user stats
          updateUserStats(data.history);

          const historyHtml = data.history.map((item, index) => `
            <div class="card" style="margin-bottom: 1.5rem; background: linear-gradient(135deg, rgba(76, 175, 80, 0.05), rgba(129, 199, 132, 0.05)); transition: all 0.3s ease;" onmouseover="this.style.transform='translateY(-5px)'" onmouseout="this.style.transform='translateY(0)'">
              <div class="card-body">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                  <div style="display: flex; align-items: center; gap: 1rem;">
                    <div style="width: 40px; height: 40px; background: var(--gradient-primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: 700;">${index + 1}</div>
                    <div>
                      <strong style="color: var(--primary-color); font-size: 1.2rem; font-family: 'Comfortaa', sans-serif;">${item.condition}</strong>
                      <div style="color: var(--text-muted); font-size: 0.9rem;">${new Date(item.created_at).toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}</div>
                    </div>
                  </div>
                  <div style="text-align: right;">
                    <div style="background: rgba(76, 175, 80, 0.2); color: var(--primary-color); padding: 0.25rem 0.75rem; border-radius: 20px; font-weight: 600; margin-bottom: 0.5rem;">
                      ${item.confidence}% Confidence
                    </div>
                    <div style="color: var(--text-secondary); font-size: 0.8rem;">
                      <i class="fas fa-clock"></i> ${item.processing_time}s
                    </div>
                  </div>
                </div>
                <div style="display: flex; gap: 1rem; margin-top: 1rem;">
                  <button onclick="viewAnalysisDetails('${item.id}')" class="btn btn-secondary" style="flex: 1;">
                    <i class="fas fa-eye"></i> View Details
                  </button>
                  <button onclick="repeatAnalysis('${item.id}')" class="btn btn-primary" style="flex: 1;">
                    <i class="fas fa-redo"></i> Repeat Analysis
                  </button>
                  <button onclick="shareAnalysis('${item.id}')" class="btn" style="flex: 1; background: linear-gradient(135deg, #9c27b0, #7b1fa2); color: white;">
                    <i class="fas fa-share"></i> Share
                  </button>
                </div>
              </div>
            </div>
          `).join('');

          container.innerHTML = historyHtml;
        } else {
          container.innerHTML = `
            <div style="text-align: center; color: var(--text-muted); padding: 3rem;">
              <div style="font-size: 4rem; margin-bottom: 1rem; opacity: 0.5;">🌱</div>
              <h3 style="color: var(--primary-color); margin-bottom: 1rem; font-family: 'Comfortaa', sans-serif;">Start Your Healing Journey</h3>
              <p style="font-size: 1.1rem; margin-bottom: 2rem;">Upload your first image to begin tracking your progress!</p>
              <button onclick="triggerFileUpload()" class="btn btn-primary" style="padding: 1rem 2rem; font-size: 1.1rem;">
                <i class="fas fa-camera"></i> Take Your First Analysis
              </button>
            </div>
          `;
        }
      } catch (error) {
        container.innerHTML = `
          <div style="text-align: center; color: var(--error-color); padding: 3rem;">
            <i class="fas fa-exclamation-triangle" style="font-size: 3rem; margin-bottom: 1rem; opacity: 0.7;"></i>
            <h3 style="margin-bottom: 1rem;">Oops! Something went wrong</h3>
            <p style="margin-bottom: 2rem;">We couldn't load your history right now.</p>
            <button onclick="loadUserHistory()" class="btn btn-primary">
              <i class="fas fa-refresh"></i> Try Again
            </button>
          </div>
        `;
      }
    }

    function updateUserStats(history) {
      // Update analysis count
      document.getElementById('userAnalysisCount').textContent = history.length;

      // Calculate remedies used (mock data for now)
      const remediesUsed = Math.min(history.length * 2, 50);
      document.getElementById('userRemediesUsed').textContent = remediesUsed;

      // Calculate streak (mock data)
      const streak = Math.min(history.length, 30);
      document.getElementById('userStreak').textContent = streak;

      // Animate counters
      animateCounters();
    }

    function animateCounters() {
      const counters = ['userAnalysisCount', 'userRemediesUsed', 'userStreak'];
      counters.forEach(counterId => {
        const element = document.getElementById(counterId);
        const target = parseInt(element.textContent);
        let current = 0;
        const increment = target / 30;

        const timer = setInterval(() => {
          current += increment;
          if (current >= target) {
            element.textContent = target;
            clearInterval(timer);
          } else {
            element.textContent = Math.floor(current);
          }
        }, 50);
      });
    }

    // New User Functions
    function startPersonalizedAnalysis() {
      showNotification('🧠 Starting AI-powered personalized analysis based on your history...', 'info', 3000);
      triggerFileUpload();
    }

    function viewRecommendations() {
      showNotification('💡 Loading smart recommendations based on your skin type and history...', 'info', 3000);
      // Scroll to personalized content
      document.getElementById('personalizedContent').scrollIntoView({ behavior: 'smooth' });
    }

    function trackProgress() {
      showNotification('📊 Progress tracking feature coming soon! We\'re building amazing analytics for you.', 'info', 4000);
    }

    function shareWithFriends() {
      if (navigator.share) {
        navigator.share({
          title: 'Heal Ayur - AI Ancient Healing',
          text: 'Check out this amazing AI-powered Ayurvedic healing app!',
          url: window.location.href
        });
      } else {
        // Fallback for browsers that don't support Web Share API
        navigator.clipboard.writeText(window.location.href);
        showNotification('🔗 Link copied to clipboard! Share with your friends.', 'success', 3000);
      }
    }

    function exportHistory() {
      showNotification('📥 Exporting your healing journey... This may take a moment.', 'info', 3000);
      // Mock export functionality
      setTimeout(() => {
        showNotification('✅ History exported successfully! Check your downloads.', 'success', 3000);
      }, 2000);
    }

    function viewAnalysisDetails(analysisId) {
      showNotification('👁️ Loading detailed analysis report...', 'info', 2000);
    }

    function repeatAnalysis(analysisId) {
      showNotification('🔄 Preparing to repeat analysis with improved AI...', 'info', 2000);
      triggerFileUpload();
    }

    function shareAnalysis(analysisId) {
      showNotification('📤 Sharing analysis with privacy protection...', 'info', 2000);
    }
    {% endif %}

    // Stats Functions
    function updateStats() {
      // Simulate live stats update
      const totalAnalyses = document.getElementById('totalAnalyses');
      const currentCount = parseInt(totalAnalyses.textContent.replace(/[^\d]/g, ''));
      totalAnalyses.textContent = (currentCount + 1).toLocaleString() + '+';

      // Update live users count
      const liveUsers = document.getElementById('liveUsers');
      const currentUsers = parseInt(liveUsers.textContent);
      liveUsers.textContent = Math.max(1, currentUsers + Math.floor(Math.random() * 3) - 1);
    }

    function showStatsDetail(statType) {
      const messages = {
        analyses: '📊 Over 1,000 successful skin analyses performed with 95%+ accuracy rate',
        remedies: '🌿 25+ categories of natural Ayurvedic remedies from ancient healing traditions',
        accuracy: '🎯 95.2% accuracy achieved through advanced AI and machine learning models',
        speed: '⚡ Average processing time of 2.1 seconds for instant results'
      };

      showNotification(messages[statType] || 'Statistics information', 'info', 5000);
    }

    // Utility Functions
    function animateProgressBars() {
      const progressBars = document.querySelectorAll('.stat-progress-bar');
      progressBars.forEach((bar, index) => {
        setTimeout(() => {
          bar.style.width = bar.style.width || '0%';
        }, index * 200);
      });
    }

    // Initialize progress bar animations when page loads
    setTimeout(animateProgressBars, 1000);

    // Performance monitoring
    window.addEventListener('load', () => {
      setTimeout(() => {
        if (performance.getEntriesByType) {
          const perfData = performance.getEntriesByType('navigation')[0];
          console.log('📊 Page load time:', Math.round(perfData.loadEventEnd - perfData.loadEventStart), 'ms');
        }
      }, 100);
    });

    // Global click handler for analyze button
    document.addEventListener('click', (e) => {
      if (e.target.id === 'analyzeBtn' || e.target.closest('#analyzeBtn')) {
        analyzeImage();
      }
    });

    // Demo function to test different conditions
    async function testCondition(condition) {
      showNotification(`🧪 Testing ${condition.replace('_', ' ')} condition...`, 'info', 2000);

      try {
        const response = await fetch('/api/test-remedies', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({ condition: condition })
        });

        const result = await response.json();

        if (result.success) {
          // Create a mock analysis result for display
          const mockResult = {
            condition: result.condition.charAt(0).toUpperCase() + result.condition.slice(1).replace('_', ' '),
            confidence: 0.88,
            processing_time: 1.2,
            remedies: result.remedies,
            ai_analysis: {
              condition: result.condition.charAt(0).toUpperCase() + result.condition.slice(1).replace('_', ' '),
              confidence: 0.88,
              severity: 'Moderate',
              professional_insights: [
                `Demo analysis for ${condition.replace('_', ' ')} condition`,
                'This is a demonstration of our AI analysis system',
                'Real analysis provides personalized recommendations'
              ]
            },
            advanced_metrics: {
              skin_brightness: Math.random() * 0.4 + 0.5,
              texture_analysis: Math.random() * 0.4 + 0.4,
              inflammation_level: Math.random() * 0.5 + 0.3,
              oil_saturation: Math.random() * 0.4 + 0.4,
              pigmentation_variation: Math.random() * 0.3 + 0.2,
              pore_visibility: Math.random() * 0.4 + 0.3
            }
          };

          displayResults(mockResult);
          showNotification(`✅ ${condition.replace('_', ' ')} analysis complete!`, 'success', 3000);
        } else {
          showNotification('❌ Demo test failed', 'error', 3000);
        }
      } catch (error) {
        console.error('Demo test error:', error);
        showNotification('❌ Demo test failed', 'error', 3000);
      }
    }

    // Prevent form submission on Enter in chat
    document.addEventListener('keydown', (e) => {
      if (e.target.id === 'chatInput' && e.key === 'Enter') {
        e.preventDefault();
        sendChatMessage();
      }
    });

    // Auto-hide notifications on click
    document.addEventListener('click', (e) => {
      if (e.target.closest('.notification-toast')) {
        const notification = e.target.closest('.notification-toast');
        notification.style.animation = 'slideOutRight 0.4s ease-out forwards';
        setTimeout(() => {
          if (notification.parentNode) {
            notification.parentNode.removeChild(notification);
          }
        }, 400);
      }
    });

    // Enhanced error handling
    window.addEventListener('error', (e) => {
      console.error('Application error:', e.error);
      showNotification('⚠️ An unexpected error occurred. Please refresh the page.', 'error');
    });

    // User Profile Functions
    function showUserProfile() {
      const modal = document.createElement('div');
      modal.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 10000;
        backdrop-filter: blur(10px);
      `;

      modal.innerHTML = `
        <div style="background: var(--gradient-card); border-radius: 20px; padding: 2rem; max-width: 700px; width: 90%; border: 1px solid var(--border-color); backdrop-filter: blur(20px); max-height: 90vh; overflow-y: auto;">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
            <h3 style="color: var(--primary-color); margin: 0; font-family: 'Comfortaa', sans-serif;">
              <i class="fas fa-user-circle"></i> {{ user.username if user else 'User' }} Profile
            </h3>
            <button onclick="this.closest('.modal').remove()" style="background: none; border: none; color: var(--text-muted); font-size: 1.5rem; cursor: pointer;">&times;</button>
          </div>

          <!-- User Avatar and Basic Info -->
          <div style="text-align: center; margin-bottom: 2rem; padding: 2rem; background: linear-gradient(135deg, rgba(76, 175, 80, 0.1), rgba(129, 199, 132, 0.05)); border-radius: 15px;">
            <div style="width: 100px; height: 100px; border-radius: 50%; background: var(--gradient-primary); display: flex; align-items: center; justify-content: center; margin: 0 auto 1rem auto; font-size: 2.5rem; color: white; font-weight: 700; box-shadow: 0 8px 25px rgba(76, 175, 80, 0.4);">
              {{ user.username[0].upper() if user else 'U' }}
            </div>
            <h2 style="color: var(--primary-color); margin-bottom: 0.5rem;">{{ user.username if user else 'User' }}</h2>
            <div style="display: inline-flex; align-items: center; gap: 0.5rem; padding: 0.5rem 1rem; background: linear-gradient(135deg, #ffd700, #ffed4e); color: #000; border-radius: 20px; font-weight: 600; font-size: 0.9rem;">
              <i class="fas fa-crown"></i> Premium Member
            </div>
            <p style="color: var(--text-secondary); margin-top: 1rem;">Member since {{ "2024" }}</p>
          </div>

          <!-- User Stats -->
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem; margin-bottom: 2rem;">
            <div style="text-align: center; padding: 1rem; background: rgba(76, 175, 80, 0.1); border-radius: 12px;">
              <div style="font-size: 1.8rem; font-weight: 700; color: var(--primary-color); font-family: 'Orbitron', monospace;" id="profileAnalysisCount">0</div>
              <div style="color: var(--text-secondary); font-size: 0.9rem;">Total Analyses</div>
            </div>
            <div style="text-align: center; padding: 1rem; background: rgba(33, 150, 243, 0.1); border-radius: 12px;">
              <div style="font-size: 1.8rem; font-weight: 700; color: #2196f3; font-family: 'Orbitron', monospace;" id="profileRemediesCount">0</div>
              <div style="color: var(--text-secondary); font-size: 0.9rem;">Remedies Tried</div>
            </div>
            <div style="text-align: center; padding: 1rem; background: rgba(255, 152, 0, 0.1); border-radius: 12px;">
              <div style="font-size: 1.8rem; font-weight: 700; color: #ff9800; font-family: 'Orbitron', monospace;" id="profileStreakCount">0</div>
              <div style="color: var(--text-secondary); font-size: 0.9rem;">Day Streak</div>
            </div>
          </div>

          <!-- Profile Actions -->
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 2rem;">
            <button onclick="viewAnalysisHistory()" class="btn btn-primary">
              <i class="fas fa-history"></i> View History
            </button>
            <button onclick="downloadUserData()" class="btn btn-secondary">
              <i class="fas fa-download"></i> Export Data
            </button>
            <button onclick="showUserSettings()" class="btn btn-secondary">
              <i class="fas fa-cog"></i> Settings
            </button>
            <button onclick="showUserAchievements()" class="btn" style="background: linear-gradient(135deg, #9c27b0, #7b1fa2); color: white;">
              <i class="fas fa-trophy"></i> Achievements
            </button>
          </div>

          <!-- Recent Activity -->
          <div style="margin-bottom: 2rem;">
            <h4 style="color: var(--primary-color); margin-bottom: 1rem;"><i class="fas fa-clock"></i> Recent Activity</h4>
            <div id="recentActivityContainer" style="max-height: 200px; overflow-y: auto;">
              <div style="padding: 1rem; background: rgba(76, 175, 80, 0.1); border-radius: 10px; margin-bottom: 0.5rem; border-left: 3px solid var(--primary-color);">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                  <span style="color: var(--text-primary); font-weight: 500;">Skin analysis completed</span>
                  <span style="color: var(--text-muted); font-size: 0.8rem;">Today</span>
                </div>
                <p style="color: var(--text-secondary); font-size: 0.9rem; margin: 0.5rem 0 0 0;">Analyzed acne condition with 95% confidence</p>
              </div>
              <div style="padding: 1rem; background: rgba(33, 150, 243, 0.1); border-radius: 10px; margin-bottom: 0.5rem; border-left: 3px solid #2196f3;">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                  <span style="color: var(--text-primary); font-weight: 500;">New remedy tried</span>
                  <span style="color: var(--text-muted); font-size: 0.8rem;">Yesterday</span>
                </div>
                <p style="color: var(--text-secondary); font-size: 0.9rem; margin: 0.5rem 0 0 0;">Started turmeric-honey face mask treatment</p>
              </div>
            </div>
          </div>

          <!-- Profile Footer -->
          <div style="text-align: center; padding-top: 1rem; border-top: 1px solid var(--border-color);">
            <p style="color: var(--text-secondary); margin-bottom: 1rem; font-size: 0.9rem;">
              <i class="fas fa-shield-alt"></i> Your data is secure and private
            </p>
            <div style="display: flex; gap: 1rem; justify-content: center;">
              <button onclick="this.closest('.modal').remove()" class="btn btn-secondary">
                <i class="fas fa-times"></i> Close
              </button>
              <button onclick="logout(); this.closest('.modal').remove();" class="btn btn-danger">
                <i class="fas fa-sign-out-alt"></i> Logout
              </button>
            </div>
          </div>
        </div>
      `;

      modal.className = 'modal';
      document.body.appendChild(modal);

      // Load user stats
      loadUserProfileStats();

      // Close on background click
      modal.addEventListener('click', (e) => {
        if (e.target === modal) {
          modal.remove();
        }
      });
    }

    async function loadUserProfileStats() {
      try {
        // Simulate loading user stats
        document.getElementById('profileAnalysisCount').textContent = Math.floor(Math.random() * 50) + 1;
        document.getElementById('profileRemediesCount').textContent = Math.floor(Math.random() * 20) + 1;
        document.getElementById('profileStreakCount').textContent = Math.floor(Math.random() * 30) + 1;
      } catch (error) {
        console.error('Error loading profile stats:', error);
      }
    }

    function viewAnalysisHistory() {
      showNotification('📊 Analysis history feature coming soon! Your data will be available in the next update.', 'info', 5000);
    }

    function downloadUserData() {
      showNotification('📥 Data export feature coming soon! You will be able to download all your analysis data.', 'info', 5000);
    }

    function showUserSettings() {
      showNotification('⚙️ User settings panel coming soon! Customize your experience and preferences.', 'info', 5000);
    }

    function showUserAchievements() {
      showNotification('🏆 Achievements system coming soon! Earn badges for your healing journey milestones.', 'info', 5000);
    }

    // Enhanced User Functions for Logged-in Users
    function startPersonalizedAnalysis() {
      showNotification('🧠 Starting personalized AI analysis... Upload an image to begin!', 'info', 4000);
      document.getElementById('fileUploadMethod').scrollIntoView({ behavior: 'smooth' });
      document.getElementById('fileUploadMethod').style.animation = 'pulse 2s infinite';
      setTimeout(() => {
        document.getElementById('fileUploadMethod').style.animation = '';
      }, 4000);
    }

    function viewRecommendations() {
      showNotification('💡 Smart recommendations based on your history are being prepared...', 'info', 4000);
      document.getElementById('personalizedContent').scrollIntoView({ behavior: 'smooth' });
    }

    function trackProgress() {
      showNotification('📈 Progress tracking dashboard coming soon! Monitor your healing journey over time.', 'info', 5000);
    }

    function shareWithFriends() {
      if (navigator.share) {
        navigator.share({
          title: 'Heal Ayur - AI-Powered Natural Healing',
          text: 'Check out this amazing AI-powered natural healing app!',
          url: window.location.href
        });
      } else {
        navigator.clipboard.writeText(window.location.href);
        showNotification('🔗 Link copied to clipboard! Share Heal Ayur with your friends.', 'success', 4000);
      }
    }

    function exportHistory() {
      showNotification('📊 Exporting your analysis history... This feature will be available soon!', 'info', 4000);
    }

    // Contact and Support Functions
    function showContactModal() {
      const modal = document.createElement('div');
      modal.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 10000;
        backdrop-filter: blur(10px);
      `;

      modal.innerHTML = `
        <div style="background: var(--gradient-card); border-radius: 20px; padding: 2rem; max-width: 600px; width: 90%; border: 1px solid var(--border-color); backdrop-filter: blur(20px); max-height: 90vh; overflow-y: auto;">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
            <h3 style="color: var(--primary-color); margin: 0;"><i class="fas fa-envelope"></i> Contact Us</h3>
            <button onclick="this.closest('.modal').remove()" style="background: none; border: none; color: var(--text-muted); font-size: 1.5rem; cursor: pointer;">&times;</button>
          </div>

          <form id="contactForm" style="margin-bottom: 1.5rem;">
            <div style="margin-bottom: 1rem;">
              <label style="display: block; margin-bottom: 0.5rem; color: var(--text-primary); font-weight: 500;">Your Name *</label>
              <input type="text" id="contactName" required style="width: 100%; padding: 0.75rem; border: 1px solid var(--border-color); border-radius: 8px; background: var(--bg-secondary); color: var(--text-primary); font-size: 1rem;">
            </div>

            <div style="margin-bottom: 1rem;">
              <label style="display: block; margin-bottom: 0.5rem; color: var(--text-primary); font-weight: 500;">Your Email *</label>
              <input type="email" id="contactEmail" required style="width: 100%; padding: 0.75rem; border: 1px solid var(--border-color); border-radius: 8px; background: var(--bg-secondary); color: var(--text-primary); font-size: 1rem;">
            </div>

            <div style="margin-bottom: 1rem;">
              <label style="display: block; margin-bottom: 0.5rem; color: var(--text-primary); font-weight: 500;">Subject *</label>
              <select id="contactSubject" required style="width: 100%; padding: 0.75rem; border: 1px solid var(--border-color); border-radius: 8px; background: var(--bg-secondary); color: var(--text-primary); font-size: 1rem;">
                <option value="">Select a subject</option>
                <option value="general">General Inquiry</option>
                <option value="technical">Technical Support</option>
                <option value="product">Product Information</option>
                <option value="business">Business Partnership</option>
                <option value="feedback">Feedback & Suggestions</option>
                <option value="other">Other</option>
              </select>
            </div>

            <div style="margin-bottom: 1.5rem;">
              <label style="display: block; margin-bottom: 0.5rem; color: var(--text-primary); font-weight: 500;">Message *</label>
              <textarea id="contactMessage" required rows="4" style="width: 100%; padding: 0.75rem; border: 1px solid var(--border-color); border-radius: 8px; background: var(--bg-secondary); color: var(--text-primary); font-size: 1rem; resize: vertical;" placeholder="Please describe your inquiry in detail..."></textarea>
            </div>

            <div style="display: flex; gap: 1rem; justify-content: center;">
              <button type="submit" class="btn btn-primary">
                <i class="fas fa-paper-plane"></i> Send Message
              </button>
              <button type="button" onclick="this.closest('.modal').remove()" class="btn btn-secondary">
                <i class="fas fa-times"></i> Cancel
              </button>
            </div>
          </form>

          <div style="text-align: center; padding-top: 1rem; border-top: 1px solid var(--border-color); color: var(--text-secondary); font-size: 0.9rem;">
            <p><i class="fas fa-clock"></i> We typically respond within 24 hours</p>
            <p><i class="fas fa-shield-alt"></i> Your information is kept private and secure</p>
          </div>
        </div>
      `;

      modal.className = 'modal';
      document.body.appendChild(modal);

      // Handle form submission
      document.getElementById('contactForm').addEventListener('submit', async (e) => {
        e.preventDefault();

        const formData = {
          name: document.getElementById('contactName').value,
          email: document.getElementById('contactEmail').value,
          subject: document.getElementById('contactSubject').value,
          message: document.getElementById('contactMessage').value
        };

        try {
          const response = await fetch('/api/contact', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify(formData)
          });

          const result = await response.json();

          if (result.success) {
            showNotification('✅ Message sent successfully! We will get back to you soon.', 'success', 5000);
            modal.remove();
          } else {
            showNotification('❌ Failed to send message. Please try again.', 'error', 5000);
          }
        } catch (error) {
          console.error('Contact form error:', error);
          showNotification('❌ Failed to send message. Please try again.', 'error', 5000);
        }
      });

      // Close on background click
      modal.addEventListener('click', (e) => {
        if (e.target === modal) {
          modal.remove();
        }
      });
    }

    function showSupportModal() {
      const modal = document.createElement('div');
      modal.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 10000;
        backdrop-filter: blur(10px);
      `;

      modal.innerHTML = `
        <div style="background: var(--gradient-card); border-radius: 20px; padding: 2rem; max-width: 600px; width: 90%; border: 1px solid var(--border-color); backdrop-filter: blur(20px);">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
            <h3 style="color: var(--primary-color); margin: 0;"><i class="fas fa-headset"></i> 24/7 Support</h3>
            <button onclick="this.closest('.modal').remove()" style="background: none; border: none; color: var(--text-muted); font-size: 1.5rem; cursor: pointer;">&times;</button>
          </div>
          <div style="margin-bottom: 1.5rem;">
            <h4 style="color: var(--primary-color); margin-bottom: 1rem;">How can we help you?</h4>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
              <div style="padding: 1rem; background: rgba(76, 175, 80, 0.1); border-radius: 10px; text-align: center;">
                <i class="fas fa-question-circle" style="font-size: 2rem; color: var(--primary-color); margin-bottom: 0.5rem;"></i>
                <h5>General Questions</h5>
                <p style="font-size: 0.9rem; color: var(--text-secondary);">Get help with using Heal Ayur</p>
              </div>
              <div style="padding: 1rem; background: rgba(76, 175, 80, 0.1); border-radius: 10px; text-align: center;">
                <i class="fas fa-bug" style="font-size: 2rem; color: var(--primary-color); margin-bottom: 0.5rem;"></i>
                <h5>Technical Issues</h5>
                <p style="font-size: 0.9rem; color: var(--text-secondary);">Report bugs or technical problems</p>
              </div>
              <div style="padding: 1rem; background: rgba(76, 175, 80, 0.1); border-radius: 10px; text-align: center;">
                <i class="fas fa-shopping-cart" style="font-size: 2rem; color: var(--primary-color); margin-bottom: 0.5rem;"></i>
                <h5>Product Inquiries</h5>
                <p style="font-size: 0.9rem; color: var(--text-secondary);">Ask about our natural products</p>
              </div>
            </div>
          </div>
          <div style="text-align: center;">
            <p style="margin-bottom: 1rem; color: var(--text-secondary);">Get help through our support channels:</p>
            <div style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
              <button onclick="showContactModal(); this.closest('.modal').remove();" class="btn btn-primary">
                <i class="fas fa-envelope"></i> Contact Form
              </button>
              <button onclick="showHelpModal(); this.closest('.modal').remove();" class="btn btn-secondary">
                <i class="fas fa-question-circle"></i> Help & FAQ
              </button>
              <button onclick="showFeedbackModal(); this.closest('.modal').remove();" class="btn btn-secondary">
                <i class="fas fa-comment"></i> Feedback
              </button>
            </div>
          </div>
        </div>
      `;

      modal.className = 'modal';
      document.body.appendChild(modal);

      // Close on background click
      modal.addEventListener('click', (e) => {
        if (e.target === modal) {
          modal.remove();
        }
      });
    }

    function showComingSoon(feature) {
      showNotification(`🚀 ${feature} is coming soon! We're working hard to bring you the best experience. Use our contact form for updates.`, 'info', 6000);
    }

    function showHelpModal() {
      const modal = document.createElement('div');
      modal.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 10000;
        backdrop-filter: blur(10px);
      `;

      modal.innerHTML = `
        <div style="background: var(--gradient-card); border-radius: 20px; padding: 2rem; max-width: 700px; width: 90%; border: 1px solid var(--border-color); backdrop-filter: blur(20px); max-height: 90vh; overflow-y: auto;">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
            <h3 style="color: var(--primary-color); margin: 0;"><i class="fas fa-question-circle"></i> Help & FAQ</h3>
            <button onclick="this.closest('.modal').remove()" style="background: none; border: none; color: var(--text-muted); font-size: 1.5rem; cursor: pointer;">&times;</button>
          </div>

          <div style="margin-bottom: 2rem;">
            <div class="faq-item" style="margin-bottom: 1.5rem; padding: 1rem; background: rgba(76, 175, 80, 0.1); border-radius: 10px;">
              <h4 style="color: var(--primary-color); margin-bottom: 0.5rem;"><i class="fas fa-camera"></i> How do I analyze my skin?</h4>
              <p style="margin: 0; color: var(--text-secondary);">Upload a clear photo of your skin or use your camera for real-time analysis. Our AI will detect skin conditions and provide natural remedy recommendations.</p>
            </div>

            <div class="faq-item" style="margin-bottom: 1.5rem; padding: 1rem; background: rgba(33, 150, 243, 0.1); border-radius: 10px;">
              <h4 style="color: #2196f3; margin-bottom: 0.5rem;"><i class="fas fa-leaf"></i> Are the remedies safe?</h4>
              <p style="margin: 0; color: var(--text-secondary);">All remedies are based on traditional Ayurvedic and natural healing practices. However, always consult a healthcare professional for serious conditions.</p>
            </div>

            <div class="faq-item" style="margin-bottom: 1.5rem; padding: 1rem; background: rgba(255, 152, 0, 0.1); border-radius: 10px;">
              <h4 style="color: #ff9800; margin-bottom: 0.5rem;"><i class="fas fa-user-plus"></i> Do I need to create an account?</h4>
              <p style="margin: 0; color: var(--text-secondary);">No! You can use basic features without an account. Creating an account unlocks premium features like history tracking and personalized recommendations.</p>
            </div>

            <div class="faq-item" style="margin-bottom: 1.5rem; padding: 1rem; background: rgba(156, 39, 176, 0.1); border-radius: 10px;">
              <h4 style="color: #9c27b0; margin-bottom: 0.5rem;"><i class="fas fa-shopping-cart"></i> Can I buy the ingredients?</h4>
              <p style="margin: 0; color: var(--text-secondary);">Yes! We offer high-quality natural ingredients like honey, turmeric, and herbal blends. Use our contact form to inquire about products.</p>
            </div>

            <div class="faq-item" style="margin-bottom: 1.5rem; padding: 1rem; background: rgba(244, 67, 54, 0.1); border-radius: 10px;">
              <h4 style="color: #f44336; margin-bottom: 0.5rem;"><i class="fas fa-shield-alt"></i> Is my data secure?</h4>
              <p style="margin: 0; color: var(--text-secondary);">Absolutely! We prioritize your privacy. Images are processed securely and not stored permanently. Your personal information is encrypted and protected.</p>
            </div>
          </div>

          <div style="text-align: center; padding-top: 1rem; border-top: 1px solid var(--border-color);">
            <p style="color: var(--text-secondary); margin-bottom: 1rem;">Still have questions?</p>
            <button onclick="showContactModal(); this.closest('.modal').remove();" class="btn btn-primary">
              <i class="fas fa-envelope"></i> Contact Support
            </button>
          </div>
        </div>
      `;

      modal.className = 'modal';
      document.body.appendChild(modal);

      // Close on background click
      modal.addEventListener('click', (e) => {
        if (e.target === modal) {
          modal.remove();
        }
      });
    }

    function showFeedbackModal() {
      const modal = document.createElement('div');
      modal.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 10000;
        backdrop-filter: blur(10px);
      `;

      modal.innerHTML = `
        <div style="background: var(--gradient-card); border-radius: 20px; padding: 2rem; max-width: 600px; width: 90%; border: 1px solid var(--border-color); backdrop-filter: blur(20px); max-height: 90vh; overflow-y: auto;">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
            <h3 style="color: var(--primary-color); margin: 0;"><i class="fas fa-comment"></i> Share Your Feedback</h3>
            <button onclick="this.closest('.modal').remove()" style="background: none; border: none; color: var(--text-muted); font-size: 1.5rem; cursor: pointer;">&times;</button>
          </div>

          <form id="feedbackForm" style="margin-bottom: 1.5rem;">
            <div style="margin-bottom: 1rem;">
              <label style="display: block; margin-bottom: 0.5rem; color: var(--text-primary); font-weight: 500;">Your Name (Optional)</label>
              <input type="text" id="feedbackName" style="width: 100%; padding: 0.75rem; border: 1px solid var(--border-color); border-radius: 8px; background: var(--bg-secondary); color: var(--text-primary); font-size: 1rem;">
            </div>

            <div style="margin-bottom: 1rem;">
              <label style="display: block; margin-bottom: 0.5rem; color: var(--text-primary); font-weight: 500;">Feedback Type *</label>
              <select id="feedbackType" required style="width: 100%; padding: 0.75rem; border: 1px solid var(--border-color); border-radius: 8px; background: var(--bg-secondary); color: var(--text-primary); font-size: 1rem;">
                <option value="">Select feedback type</option>
                <option value="suggestion">Suggestion</option>
                <option value="bug">Bug Report</option>
                <option value="feature">Feature Request</option>
                <option value="compliment">Compliment</option>
                <option value="complaint">Complaint</option>
                <option value="other">Other</option>
              </select>
            </div>

            <div style="margin-bottom: 1rem;">
              <label style="display: block; margin-bottom: 0.5rem; color: var(--text-primary); font-weight: 500;">Rating (Optional)</label>
              <div style="display: flex; gap: 0.5rem; align-items: center;">
                <span style="color: var(--text-secondary);">Poor</span>
                <div class="rating-stars" style="display: flex; gap: 0.25rem;">
                  <i class="fas fa-star rating-star" data-rating="1" style="color: #ddd; cursor: pointer; font-size: 1.2rem;"></i>
                  <i class="fas fa-star rating-star" data-rating="2" style="color: #ddd; cursor: pointer; font-size: 1.2rem;"></i>
                  <i class="fas fa-star rating-star" data-rating="3" style="color: #ddd; cursor: pointer; font-size: 1.2rem;"></i>
                  <i class="fas fa-star rating-star" data-rating="4" style="color: #ddd; cursor: pointer; font-size: 1.2rem;"></i>
                  <i class="fas fa-star rating-star" data-rating="5" style="color: #ddd; cursor: pointer; font-size: 1.2rem;"></i>
                </div>
                <span style="color: var(--text-secondary);">Excellent</span>
              </div>
              <input type="hidden" id="feedbackRating" value="">
            </div>

            <div style="margin-bottom: 1.5rem;">
              <label style="display: block; margin-bottom: 0.5rem; color: var(--text-primary); font-weight: 500;">Your Feedback *</label>
              <textarea id="feedbackMessage" required rows="4" style="width: 100%; padding: 0.75rem; border: 1px solid var(--border-color); border-radius: 8px; background: var(--bg-secondary); color: var(--text-primary); font-size: 1rem; resize: vertical;" placeholder="Please share your thoughts, suggestions, or report any issues..."></textarea>
            </div>

            <div style="display: flex; gap: 1rem; justify-content: center;">
              <button type="submit" class="btn btn-primary">
                <i class="fas fa-paper-plane"></i> Send Feedback
              </button>
              <button type="button" onclick="this.closest('.modal').remove()" class="btn btn-secondary">
                <i class="fas fa-times"></i> Cancel
              </button>
            </div>
          </form>

          <div style="text-align: center; padding-top: 1rem; border-top: 1px solid var(--border-color); color: var(--text-secondary); font-size: 0.9rem;">
            <p><i class="fas fa-heart"></i> Your feedback helps us improve Heal Ayur for everyone!</p>
          </div>
        </div>
      `;

      modal.className = 'modal';
      document.body.appendChild(modal);

      // Handle star rating
      const stars = modal.querySelectorAll('.rating-star');
      stars.forEach(star => {
        star.addEventListener('click', () => {
          const rating = star.dataset.rating;
          document.getElementById('feedbackRating').value = rating;

          stars.forEach((s, index) => {
            if (index < rating) {
              s.style.color = '#ffd700';
            } else {
              s.style.color = '#ddd';
            }
          });
        });

        star.addEventListener('mouseenter', () => {
          const rating = star.dataset.rating;
          stars.forEach((s, index) => {
            if (index < rating) {
              s.style.color = '#ffd700';
            } else {
              s.style.color = '#ddd';
            }
          });
        });
      });

      // Handle form submission
      document.getElementById('feedbackForm').addEventListener('submit', async (e) => {
        e.preventDefault();

        const formData = {
          name: document.getElementById('feedbackName').value || 'Anonymous',
          type: document.getElementById('feedbackType').value,
          rating: document.getElementById('feedbackRating').value,
          message: document.getElementById('feedbackMessage').value
        };

        try {
          const response = await fetch('/api/feedback', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify(formData)
          });

          const result = await response.json();

          if (result.success) {
            showNotification('✅ Thank you for your feedback! We appreciate your input.', 'success', 5000);
            modal.remove();
          } else {
            showNotification('❌ Failed to send feedback. Please try again.', 'error', 5000);
          }
        } catch (error) {
          console.error('Feedback form error:', error);
          showNotification('❌ Failed to send feedback. Please try again.', 'error', 5000);
        }
      });

      // Close on background click
      modal.addEventListener('click', (e) => {
        if (e.target === modal) {
          modal.remove();
        }
      });
    }

    // Service worker registration for PWA features
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/static/sw.js')
          .then(registration => console.log('SW registered'))
          .catch(error => console.log('SW registration failed'));
      });
    }
  </script>
</body>
</html>
